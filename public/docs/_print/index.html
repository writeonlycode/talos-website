<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.92.0" />
<link rel="canonical" type="text/html" href="/docs/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Welcome | Talos</title>
<meta name="description" content="Welcome
Welcome to the Talos documentation.
If you are just getting familiar with Talos, we recommend starting here:

What is Talos: a quick …">
<meta property="og:title" content="Welcome" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/" />

<meta itemprop="name" content="Welcome">
<meta itemprop="description" content=""><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Welcome"/>
<meta name="twitter:description" content=""/>




<link rel="preload" href="/scss/main.min.04d45cbf9e8ce4d4af81280fe85913966e0e6cda7a78c5264e5846a26d93c636.css" as="style">
<link href="/scss/main.min.04d45cbf9e8ce4d4af81280fe85913966e0e6cda7a78c5264e5846a26d93c636.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-00000000-0', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class="text-uppercase font-weight-bold">Talos</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">Documentation</span></a>
			</li>
			
			
			<li class="nav-item dropdown mr-4 d-none d-lg-block">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	Releases
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="https://v0-2.kubeflow.org">v0.6</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.7</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.8</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.9</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.10</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.11</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.12</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.13</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v0.14</a>
	
	<a class="dropdown-item" href="https://v0-3.kubeflow.org">v1.0</a>
	
</div>

			</li>
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input type="search" class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Welcome</h1>





    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-9422654fa1e23156375a845d4b83170e">Bare Metal Platforms</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-64ac2c3b15dc480b7716e60bfc30ce7e">Digital Rebar</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-fc81ec55931d5c855d54a591c9dbd9e6">Equinix Metal</a></li>


    
  
    
    
	
<li>1.3: <a href="#pg-ba69c2dd5620061e525d9996b21772fa">Matchbox</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-243d1f7cdc79e45554250273b8e929de">Sidero</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-3f3d3e832598bf3755794498b9a5bee0">Cloud Platforms</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-1b45fe3ab3a3eca642ace0f0234bf902">AWS</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-9521fc29a6d48d8b0003a0973eb0d21b">Azure</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-06c447084c1f167a44e6754bced0a1df">DigitalOcean</a></li>


    
  
    
    
	
<li>2.4: <a href="#pg-d786f979280314493c028c85305ceed0">GCP</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-d2c6535126cca927d2a9c893abde92a0">Gides</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>3.1: <a href="#pg-c281f9289754089f3fbb34f422ac4b71">Advanced Networking</a></li>


    
  
    
    
	
<li>3.2: <a href="#pg-2c37d55bff1b34046a01607cb81e21dc">Configuring Containerd</a></li>


    
  
    
    
	
<li>3.3: <a href="#pg-2f14629b161e61b1637fade69b2bae91">Configuring Corporate Proxies</a></li>


    
  
    
    
	
<li>3.4: <a href="#pg-88e87571b8b84ca8840f0ce75e87ee6c">Configuring Pull Through Cache</a></li>


    
  
    
    
	
<li>3.5: <a href="#pg-07c8bd101e3aa1d4dfdf920a1ec11447">Configuring the Cluster Endpoint</a></li>


    
  
    
    
	
<li>3.6: <a href="#pg-d4c3bffeb2b85220403773327181707e">Customizing the Kernel</a></li>


    
  
    
    
	
<li>3.7: <a href="#pg-154cfa2281a3a1ec2677e0d27b6d632c">Customizing the Root Filesystem</a></li>


    
  
    
    
	
<li>3.8: <a href="#pg-6c53eb082db3ba8b955139d995481c8b">Managing PKI</a></li>


    
  
    
    
	
<li>3.9: <a href="#pg-7b65b067e7f3a1d78f9acdfb89730023">Resetting a Machine</a></li>


    
  
    
    
	
<li>3.10: <a href="#pg-1725f639c2964c56ab86e6391b52a6a6">Upgrading Kubernetes</a></li>


    
  
    
    
	
<li>3.11: <a href="#pg-d9842e6290a13813a9a577de45cbca25">Upgrading Talos</a></li>


    
  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-d1742b0a409facb9dc9b2828826c6df3">Introduction</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>4.1: <a href="#pg-d4ee8bb096719d6becadaaf818c47610">What is Talos?</a></li>


    
  
    
    
	
<li>4.2: <a href="#pg-81d9f057f563127c5d467a780c68346e">Quickstart</a></li>


    
  
    
    
	
<li>4.3: <a href="#pg-b5d2b35b8cf8ae404c7e6fb7021d5381">System Requirements</a></li>


    
  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-9322b4de95a0e0fb454330803430d220">Learn More</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-a160e75460ac4544535966f30cafa0dc">Architecture</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-9dec7054fa62608c2e3aaaca3e418934">FAQs</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-58c92d862c844977ef9db34132dfe2ca">Local Platforms</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>6.1: <a href="#pg-6195af5424c7a2a54e778425699a9021">Docker</a></li>


    
  
    
    
	
<li>6.2: <a href="#pg-f57082df6a8be07422a5628802d0798d">Firecracker</a></li>


    
  
    
    
	
<li>6.3: <a href="#pg-8ed0ebdc1cb4547d368d9fcf0f14c45b">QEMU</a></li>


    
  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-b00a88a07ceb21b1a83e5822e0c86c1d">Reference</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>7.1: <a href="#pg-e258fa43c114d11d63abd25106fafe87">Configuration</a></li>


    
  

    </ul>
    
  
    
    
	
<li>8: <a href="#pg-183bbaed2c8c4fb9e080fa3e6a67f9ad">Virtualized Platforms</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>8.1: <a href="#pg-a4f2a371fb298324d51b12f31514c5cd">Hyper-V</a></li>


    
  
    
    
	
<li>8.2: <a href="#pg-93515b515d47d3fa0127424282a22a10">KVM</a></li>


    
  
    
    
	
<li>8.3: <a href="#pg-d61a94d39bacb036d37cb29d7f9b62f2">Proxmox</a></li>


    
  
    
    
	
<li>8.4: <a href="#pg-0f59ff1d2cb197f7cfaf0ffa7ea05bbc">VMware</a></li>


    
  
    
    
	
<li>8.5: <a href="#pg-a17a30484a09b0ced1d0ebb1dda5950b">Xen</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      <h2 id="welcome">Welcome</h2>
<p>Welcome to the Talos documentation.
If you are just getting familiar with Talos, we recommend starting here:</p>
<ul>
<li><a href="introduction/what-is-talos/">What is Talos</a>: a quick description of Talos</li>
<li><a href="introduction/quickstart/">Quickstart</a>: the fastest way to get a Talos cluster up and running</li>
<li><a href="introduction/getting-started/">Getting Started</a>: a long-form, guided tour of getting a full Talos cluster deployed</li>
</ul>
<h2 id="open-source">Open Source</h2>
<h3 id="community">Community</h3>
<ul>
<li>GitHub: <a href="https://github.com/talos-systems/talos">repo</a></li>
<li>Slack: Join our <a href="https://slack.dev.talos-systems.io">slack channel</a></li>
<li>Matrix: Join our Matrix channels:
<ul>
<li>Community: <a href="https://matrix.to/#/#talos:matrix.org">#talos:matrix.org</a></li>
<li>Support: <a href="https://matrix.to/#/#talos-support:matrix.org">#talos-support:matrix.org</a></li>
</ul>
</li>
<li>Support: Questions, bugs, feature requests <a href="https://github.com/talos-systems/talos/discussions">GitHub Discussions</a></li>
<li>Forum: <a href="https://groups.google.com/a/siderolabs.com/forum/#!forum/community">community</a></li>
<li>Twitter: <a href="https://twitter.com/talossystems">@SideroLabs</a></li>
<li>Email: <a href="mailto:info@SideroLabs.com">info@SideroLabs.com</a></li>
</ul>
<p>If you&rsquo;re interested in this project and would like to help in engineering efforts, or have general usage questions, we are happy to have you!
We hold a weekly meeting that all audiences are welcome to attend.</p>
<p>We would appreciate your feedback so that we can make Talos even better!
To do so, you can take our <a href="https://docs.google.com/forms/d/1TUna5YTYGCKot68Y9YN_CLobY6z9JzLVCq1G7DoyNjA/edit">survey</a>.</p>
<h3 id="office-hours">Office Hours</h3>
<ul>
<li>When: Mondays at 16:30 UTC.</li>
<li>Where: <a href="https://meet.google.com/day-pxhv-zky">Google Meet</a>.</li>
</ul>
<p>You can subscribe to this meeting by joining the community forum above.</p>
<h2 id="enterprise">Enterprise</h2>
<p>If you are using Talos in a production setting, and need consulting services to get started or to integrate Talos into your existing environment, we can help.
Sidero Labs, Inc. offers support contracts with SLA (Service Level Agreement)-bound terms for mission-critical environments.</p>
<p><a href="https://www.siderolabs.com/support/">Learn More</a></p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9422654fa1e23156375a845d4b83170e">1 - Bare Metal Platforms</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-64ac2c3b15dc480b7716e60bfc30ce7e">1.1 - Digital Rebar</h1>
    
	<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>3 nodes (please see <a href="https://www.talos.dev/docs/v0.6/en/guides/getting-started#system-requirements">hardware requirements</a>)</li>
<li>Loadbalancer</li>
<li>Digital Rebar Server</li>
<li>Talosctl access (see <a href="https://www.talos.dev/docs/v0.6/en/guides/getting-started/talosctl">talosctl setup</a>)</li>
</ul>
<h2 id="creating-a-cluster">Creating a Cluster</h2>
<p>In this guide we will create an Kubernetes cluster with 1 worker node, and 2 controlplane nodes.
We assume an existing digital rebar deployment, and some familiarity with iPXE.</p>
<p>We leave it up to the user to decide if they would like to use static networking, or DHCP.
The setup and configuration of DHCP will not be covered.</p>
<h3 id="create-the-machine-configuration-files">Create the Machine Configuration Files</h3>
<h4 id="generating-base-configurations">Generating Base Configurations</h4>
<p>Using the DNS name of the load balancer, generate the base configuration files for the Talos machines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl gen config talos-k8s-metal-tutorial https://&lt;load balancer IP or DNS&gt;:&lt;port&gt;
created init.yaml
created controlplane.yaml
created join.yaml
created talosconfig
</code></pre></div><blockquote>
<p>The loadbalancer is used to distribute the load across multiple controlplane nodes.
This isn&rsquo;t covered in detail, because we asume some loadbalancing knowledge before hand.
If you think this should be added to the docs, please <a href="https://github.com/talos-systems/talos/issues">create a issue</a>.</p>
</blockquote>
<p>At this point, you can modify the generated configs to your liking.</p>
<h4 id="validate-the-configuration-files">Validate the Configuration Files</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl validate --config init.yaml --mode metal
init.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> metal mode
$ talosctl validate --config controlplane.yaml --mode metal
controlplane.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> metal mode
$ talosctl validate --config join.yaml --mode metal
join.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> metal mode
</code></pre></div><h4 id="publishing-the-machine-configuration-files">Publishing the Machine Configuration Files</h4>
<p>Digital Rebar has a build-in fileserver, which means we can use this feature to expose the talos configuration files.
We will place <code>init.yaml</code>, <code>controlplane.yaml</code>, and <code>worker.yaml</code> into Digital Rebar file server by using the <code>drpcli</code> tools.</p>
<p>Copy the generated files from the step above into your Digital Rebar installation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">drpcli file upload &lt;file&gt;.yaml as &lt;file&gt;.yaml
</code></pre></div><p>Replacing <code>&lt;file&gt;</code> with init, controlplane or worker.</p>
<h3 id="download-the-boot-files">Download the boot files</h3>
<p>Download a recent version of <code>boot.tar.gz</code> from <a href="https://github.com/talos-systems/talos/releases/">github.</a></p>
<p>Upload to DRB:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ drpcli isos upload boot.tar.gz as talos.tar.gz
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;Path&#34;</span>: <span style="color:#4e9a06">&#34;talos.tar.gz&#34;</span>,
  <span style="color:#4e9a06">&#34;Size&#34;</span>: <span style="color:#0000cf;font-weight:bold">96470072</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><p>We have some Digital Rebar <a href="https://github.com/talos-systems/talos/tree/master/hack/test/digitalrebar/">example files</a> in the Git repo you can use to provision Digital Rebar with drpcli.</p>
<p>To apply these configs you need to create them, and then apply them as follow:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ drpcli bootenvs create talos
<span style="color:#ce5c00;font-weight:bold">{</span>
  <span style="color:#4e9a06">&#34;Available&#34;</span>: true,
  <span style="color:#4e9a06">&#34;BootParams&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
  <span style="color:#4e9a06">&#34;Bundle&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
  <span style="color:#4e9a06">&#34;Description&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
  <span style="color:#4e9a06">&#34;Documentation&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
  <span style="color:#4e9a06">&#34;Endpoint&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
  <span style="color:#4e9a06">&#34;Errors&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
  <span style="color:#4e9a06">&#34;Initrds&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
  <span style="color:#4e9a06">&#34;Kernel&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
  <span style="color:#4e9a06">&#34;Meta&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{}</span>,
  <span style="color:#4e9a06">&#34;Name&#34;</span>: <span style="color:#4e9a06">&#34;talos&#34;</span>,
  <span style="color:#4e9a06">&#34;OS&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;Codename&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
    <span style="color:#4e9a06">&#34;Family&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
    <span style="color:#4e9a06">&#34;IsoFile&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
    <span style="color:#4e9a06">&#34;IsoSha256&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
    <span style="color:#4e9a06">&#34;IsoUrl&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
    <span style="color:#4e9a06">&#34;Name&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>,
    <span style="color:#4e9a06">&#34;SupportedArchitectures&#34;</span>: <span style="color:#ce5c00;font-weight:bold">{}</span>,
    <span style="color:#4e9a06">&#34;Version&#34;</span>: <span style="color:#4e9a06">&#34;&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">}</span>,
  <span style="color:#4e9a06">&#34;OnlyUnknown&#34;</span>: false,
  <span style="color:#4e9a06">&#34;OptionalParams&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
  <span style="color:#4e9a06">&#34;ReadOnly&#34;</span>: false,
  <span style="color:#4e9a06">&#34;RequiredParams&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
  <span style="color:#4e9a06">&#34;Templates&#34;</span>: <span style="color:#ce5c00;font-weight:bold">[]</span>,
  <span style="color:#4e9a06">&#34;Validated&#34;</span>: <span style="color:#204a87">true</span>
<span style="color:#ce5c00;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">drpcli bootenvs update talos - &lt; bootenv.yaml
</code></pre></div><blockquote>
<p>You need to do this for all files in the example directory.
If you don&rsquo;t have access to the <code>drpcli</code> tools you can also use the webinterface.</p>
</blockquote>
<p>It&rsquo;s important to have a corresponding SHA256 hash matching the boot.tar.gz</p>
<h4 id="bootenv-bootparams">Bootenv BootParams</h4>
<p>We&rsquo;re using some of Digital Rebar build in templating to make sure the machine gets the correct role assigned.</p>
<p><code>talos.platform=metal talos.config={{ .ProvisionerURL }}/files/{{.Param \&quot;talos/role\&quot;}}.yaml&quot;</code></p>
<p>This is why we also include a <code>params.yaml</code> in the example directory to make sure the role is set to one of the following:</p>
<ul>
<li>controlplane</li>
<li>init</li>
<li>worker</li>
</ul>
<p>The <code>{{.Param \&quot;talos/role\&quot;}}</code> then gets populated with one of the above roles.</p>
<h3 id="boot-the-machines">Boot the Machines</h3>
<p>In the UI of Digital Rebar you need to select the machines you want te provision.
Once selected, you need to assign to following:</p>
<ul>
<li>Profile</li>
<li>Workflow</li>
</ul>
<p>This will provision the Stage and Bootenv with the talos values.
Once this is done, you can boot the machine.</p>
<p>To understand the boot process, we have a higher level overview located at <a href="https://www.talos.dev/docs/v0.6/en/guides/metal/overview">metal overview.</a></p>
<h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>Once everything is running we can retrieve the admin <code>kubeconfig</code> by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl --talosconfig talosconfig config endpoint &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig config node &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig kubeconfig .
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fc81ec55931d5c855d54a591c9dbd9e6">1.2 - Equinix Metal</h1>
    
	<p>Talos is known to work on Equinix Metal; however, it is currently undocumented.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ba69c2dd5620061e525d9996b21772fa">1.3 - Matchbox</h1>
    
	<h2 id="creating-a-cluster">Creating a Cluster</h2>
<p>In this guide we will create an HA Kubernetes cluster with 3 worker nodes.
We assume an existing load balancer, matchbox deployment, and some familiarity with iPXE.</p>
<p>We leave it up to the user to decide if they would like to use static networking, or DHCP.
The setup and configuration of DHCP will not be covered.</p>
<h3 id="create-the-machine-configuration-files">Create the Machine Configuration Files</h3>
<h4 id="generating-base-configurations">Generating Base Configurations</h4>
<p>Using the DNS name of the load balancer, generate the base configuration files for the Talos machines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl gen config talos-k8s-metal-tutorial https://&lt;load balancer IP or DNS&gt;:&lt;port&gt;
created init.yaml
created controlplane.yaml
created join.yaml
created talosconfig
</code></pre></div><p>At this point, you can modify the generated configs to your liking.</p>
<h4 id="validate-the-configuration-files">Validate the Configuration Files</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl validate --config init.yaml --mode metal
init.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> metal mode
$ talosctl validate --config controlplane.yaml --mode metal
controlplane.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> metal mode
$ talosctl validate --config join.yaml --mode metal
join.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> metal mode
</code></pre></div><h4 id="publishing-the-machine-configuration-files">Publishing the Machine Configuration Files</h4>
<p>In bare-metal setups it is up to the user to provide the configuration files over HTTP(S).
A special kernel parameter (<code>talos.config</code>) must be used to inform Talos about <em>where</em> it should retreive its' configuration file.
To keep things simple we will place <code>init.yaml</code>, <code>controlplane.yaml</code>, and <code>join.yaml</code> into Matchbox&rsquo;s <code>assets</code> directory.
This directory is automatically served by Matchbox.</p>
<h3 id="create-the-matchbox-configuration-files">Create the Matchbox Configuration Files</h3>
<p>The profiles we will create will reference <code>vmlinuz</code>, and <code>initramfs.xz</code>.
Download these files from the <a href="https://github.com/talos-systems/talos/releases">release</a> of your choice, and place them in <code>/var/lib/matchbox/assets</code>.</p>
<h4 id="profiles">Profiles</h4>
<h5 id="the-bootstrap-node">The Bootstrap Node</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;init&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;init&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;boot&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;kernel&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;/assets/vmlinuz&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;initrd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;/assets/initramfs.xz&#34;</span><span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;initrd=initramfs.xz&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;page_poison=1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;slab_nomerge&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;slub_debug=P&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;pti=on&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;console=tty0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;console=ttyS0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;printk.devkmsg=on&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;talos.platform=metal&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;talos.config=http://matchbox.talos.dev/assets/init.yaml&#34;</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><blockquote>
<p>Note: Be sure to change <code>http://matchbox.talos.dev</code> to the endpoint of your matchbox server.</p>
</blockquote>
<h5 id="additional-control-plane-nodes">Additional Control Plane Nodes</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;boot&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;kernel&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;/assets/vmlinuz&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;initrd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;/assets/initramfs.xz&#34;</span><span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;initrd=initramfs.xz&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;page_poison=1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;slab_nomerge&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;slub_debug=P&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;pti=on&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;console=tty0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;console=ttyS0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;printk.devkmsg=on&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;talos.platform=metal&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;talos.config=http://matchbox.talos.dev/assets/controlplane.yaml&#34;</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h5 id="worker-nodes">Worker Nodes</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;boot&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#204a87;font-weight:bold">&#34;kernel&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;/assets/vmlinuz&#34;</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#204a87;font-weight:bold">&#34;initrd&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;/assets/initramfs.xz&#34;</span><span style="color:#000;font-weight:bold">],</span>
    <span style="color:#204a87;font-weight:bold">&#34;args&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span>
      <span style="color:#4e9a06">&#34;initrd=initramfs.xz&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;page_poison=1&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;slab_nomerge&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;slub_debug=P&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;pti=on&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;console=tty0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;console=ttyS0&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;printk.devkmsg=on&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;talos.platform=metal&#34;</span><span style="color:#000;font-weight:bold">,</span>
      <span style="color:#4e9a06">&#34;talos.config=http://matchbox.talos.dev/assets/join.yaml&#34;</span>
    <span style="color:#000;font-weight:bold">]</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h4 id="groups">Groups</h4>
<p>Now, create the following groups, and ensure that the <code>selector</code>s are accurate for your specific setup.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane-1&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane-1&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;profile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;init&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;selector&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#a40000">...</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane-2&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane-2&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;profile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;selector&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#a40000">...</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane-3&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane-3&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;profile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;control-plane&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;selector&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#a40000">...</span>
  <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#000;font-weight:bold">{</span>
  <span style="color:#204a87;font-weight:bold">&#34;id&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;name&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#204a87;font-weight:bold">&#34;profile&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;default&#34;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><h3 id="boot-the-machines">Boot the Machines</h3>
<p>Now that we have our configuraton files in place, boot all the machines.
Talos will come up on each machine, grab its' configuration file, and bootstrap itself.</p>
<h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>At this point we can retrieve the admin <code>kubeconfig</code> by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl --talosconfig talosconfig config endpoint &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig config node &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig kubeconfig .
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-243d1f7cdc79e45554250273b8e929de">1.4 - Sidero</h1>
    
	<p>Sidero is a project created by the Talos team that has native support for Talos.
The best way to get started with Sidero is to visit the <a href="https://www.sidero.dev/">website</a>.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3f3d3e832598bf3755794498b9a5bee0">2 - Cloud Platforms</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-1b45fe3ab3a3eca642ace0f0234bf902">2.1 - AWS</h1>
    
	<h2 id="creating-a-cluster-via-the-aws-cli">Creating a Cluster via the AWS CLI</h2>
<p>In this guide we will create an HA Kubernetes cluster with 3 worker nodes.
We assume an existing VPC, and some familiarity with AWS.
If you need more information on AWS specifics, please see the <a href="https://docs.aws.amazon.com">official AWS documentation</a>.</p>
<h3 id="create-the-subnet">Create the Subnet</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 create-subnet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --vpc-id <span style="color:#000">$VPC</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --cidr-block <span style="color:#4e9a06">${</span><span style="color:#000">CIDR_BLOCK</span><span style="color:#4e9a06">}</span>
</code></pre></div><h3 id="create-the-ami">Create the AMI</h3>
<h4 id="prepare-the-import-prerequisites">Prepare the Import Prerequisites</h4>
<h5 id="create-the-s3-bucket">Create the S3 Bucket</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws s3api create-bucket <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --bucket <span style="color:#000">$BUCKET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --create-bucket-configuration <span style="color:#000">LocationConstraint</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --acl private
</code></pre></div><h5 id="create-the-vmimport-role">Create the <code>vmimport</code> Role</h5>
<p>In order to create an AMI, ensure that the <code>vmimport</code> role exists as described in the <a href="https://docs.aws.amazon.com/vm-import/latest/userguide/vmie_prereqs.html#vmimport-role">official AWS documentation</a>.</p>
<p>Note that the role should be associated with the S3 bucket we created above.</p>
<h5 id="create-the-image-snapshot">Create the Image Snapshot</h5>
<p>First, download the AWS image from a Talos release:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -LO https://github.com/talos-systems/talos/releases/latest/download/aws.tar.gz <span style="color:#000;font-weight:bold">|</span> tar -xv
</code></pre></div><p>Copy the RAW disk to S3 and import it as a snapshot:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws s3 cp disk.raw s3://<span style="color:#000">$BUCKET</span>/talos-aws-tutorial.raw
aws ec2 import-snapshot <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --description <span style="color:#4e9a06">&#34;Talos kubernetes tutorial&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --disk-container <span style="color:#4e9a06">&#34;Format=raw,UserBucket={S3Bucket=</span><span style="color:#000">$BUCKET</span><span style="color:#4e9a06">,S3Key=talos-aws-tutorial.raw}&#34;</span>
</code></pre></div><p>Save the <code>SnapshotId</code>, as we will need it once the import is done.
To check on the status of the import, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 describe-import-snapshot-tasks <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --import-task-ids
</code></pre></div><p>Once the <code>SnapshotTaskDetail.Status</code> indicates <code>completed</code>, we can register the image.</p>
<h5 id="register-the-image">Register the Image</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 register-image <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --block-device-mappings <span style="color:#4e9a06">&#34;DeviceName=/dev/xvda,VirtualName=talos,Ebs={DeleteOnTermination=true,SnapshotId=</span><span style="color:#000">$SNAPSHOT</span><span style="color:#4e9a06">,VolumeSize=4,VolumeType=gp2}&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --root-device-name /dev/xvda <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --virtualization-type hvm <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --architecture x86_64 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --ena-support <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-aws-tutorial-ami
</code></pre></div><p>We now have an AMI we can use to create our cluster.
Save the AMI ID, as we will need it when we create EC2 instances.</p>
<h3 id="create-a-security-group">Create a Security Group</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 create-security-group <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-name talos-aws-tutorial-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --description <span style="color:#4e9a06">&#34;Security Group for EC2 instances to allow ports required by Talos&#34;</span>
</code></pre></div><p>Using the security group ID from above, allow all internal traffic within the same security group:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 authorize-security-group-ingress <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-name talos-aws-tutorial-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --protocol all <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --port <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-id <span style="color:#000">$SECURITY_GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --source-group <span style="color:#000">$SECURITY_GROUP</span>
</code></pre></div><p>and expose the Talos and Kubernetes APIs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 authorize-security-group-ingress <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-name talos-aws-tutorial-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --protocol tcp <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --port <span style="color:#0000cf;font-weight:bold">6443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --cidr 0.0.0.0/0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-id <span style="color:#000">$SECURITY_GROUP</span>
aws ec2 authorize-security-group-ingress <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-name talos-aws-tutorial-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --protocol tcp <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --port 50000-50001 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --cidr 0.0.0.0/0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --group-id <span style="color:#000">$SECURITY_GROUP</span>
</code></pre></div><h3 id="create-a-load-balancer">Create a Load Balancer</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws elbv2 create-load-balancer <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-aws-tutorial-lb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --type network --subnets <span style="color:#000">$SUBNET</span>
</code></pre></div><p>Take note of the DNS name and ARN.
We will need these soon.</p>
<h3 id="create-the-machine-configuration-files">Create the Machine Configuration Files</h3>
<h4 id="generating-base-configurations">Generating Base Configurations</h4>
<p>Using the DNS name of the loadbalancer created earlier, generate the base configuration files for the Talos machines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl gen config talos-k8s-aws-tutorial https://&lt;load balancer IP or DNS&gt;:&lt;port&gt;
created init.yaml
created controlplane.yaml
created join.yaml
created talosconfig
</code></pre></div><p>At this point, you can modify the generated configs to your liking.</p>
<h4 id="validate-the-configuration-files">Validate the Configuration Files</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl validate --config init.yaml --mode cloud
init.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
$ talosctl validate --config controlplane.yaml --mode cloud
controlplane.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
$ talosctl validate --config join.yaml --mode cloud
join.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
</code></pre></div><h3 id="create-the-ec2-instances">Create the EC2 Instances</h3>
<blockquote>
<p>Note: There is a known issue that prevents Talos from running on T2 instance types.
Please use T3 if you need burstable instance types.</p>
</blockquote>
<h4 id="create-the-bootstrap-node">Create the Bootstrap Node</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 run-instances <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image-id <span style="color:#000">$AMI</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --count <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --instance-type t3.small <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data file://init.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --subnet-id <span style="color:#000">$SUBNET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --security-group-ids <span style="color:#000">$SECURITY_GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tag-specifications <span style="color:#4e9a06">&#34;ResourceType=instance,Tags=[{Key=Name,Value=talos-aws-tutorial-cp-0}]&#34;</span>
</code></pre></div><h4 id="create-the-remaining-control-plane-nodes">Create the Remaining Control Plane Nodes</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">CP_COUNT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
<span style="color:#204a87;font-weight:bold">while</span> <span style="color:#ce5c00;font-weight:bold">[[</span> <span style="color:#4e9a06">&#34;</span><span style="color:#000">$CP_COUNT</span><span style="color:#4e9a06">&#34;</span> -lt <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#ce5c00;font-weight:bold">]]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
  aws ec2 run-instances <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image-id <span style="color:#000">$AMI</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --count <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --instance-type t3.small <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data file://controlplane.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --subnet-id <span style="color:#000">$SUBNET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --security-group-ids <span style="color:#000">$SECURITY_GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tag-specifications <span style="color:#4e9a06">&#34;ResourceType=instance,Tags=[{Key=Name,Value=talos-aws-tutorial-cp-</span><span style="color:#000">$CP_COUNT</span><span style="color:#4e9a06">}]&#34;</span>
  <span style="color:#ce5c00;font-weight:bold">((</span>CP_COUNT++<span style="color:#ce5c00;font-weight:bold">))</span>
<span style="color:#204a87;font-weight:bold">done</span>
</code></pre></div><blockquote>
<p>Make a note of the resulting <code>PrivateIpAddress</code> from the init and controlplane nodes for later use.</p>
</blockquote>
<h4 id="create-the-worker-nodes">Create the Worker Nodes</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws ec2 run-instances <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image-id <span style="color:#000">$AMI</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --count <span style="color:#0000cf;font-weight:bold">3</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --instance-type t3.small <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data file://join.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --subnet-id <span style="color:#000">$SUBNET</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --security-group-ids <span style="color:#000">$SECURITY_GROUP</span>
    --tag-specifications <span style="color:#4e9a06">&#34;ResourceType=instance,Tags=[{Key=Name,Value=talos-aws-tutorial-worker}]&#34;</span>
</code></pre></div><h3 id="configure-the-load-balancer">Configure the Load Balancer</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws elbv2 create-target-group <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-aws-tutorial-tg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --protocol TCP <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --port <span style="color:#0000cf;font-weight:bold">6443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --vpc-id <span style="color:#000">$VPC</span>
</code></pre></div><p>Now, using the target group&rsquo;s ARN, and the <strong>PrivateIpAddress</strong> from the instances that you created :</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws elbv2 register-targets <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --target-group-arn <span style="color:#000">$TARGET_GROUP_ARN</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --targets <span style="color:#000">Id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$CP_NODE_1_IP</span>  <span style="color:#000">Id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$CP_NODE_2_IP</span>  <span style="color:#000">Id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$CP_NODE_3_IP</span>
</code></pre></div><p>Using the ARNs of the load balancer and target group from previous steps, create the listener:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws elbv2 create-listener <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --load-balancer-arn <span style="color:#000">$LOAD_BALANCER_ARN</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --protocol TCP <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --port <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --default-actions <span style="color:#000">Type</span><span style="color:#ce5c00;font-weight:bold">=</span>forward,TargetGroupArn<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">$TARGET_GROUP_ARN</span>
</code></pre></div><h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>At this point we can retrieve the admin <code>kubeconfig</code> by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl --talosconfig talosconfig config endpoint &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig config node &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig kubeconfig .
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9521fc29a6d48d8b0003a0973eb0d21b">2.2 - Azure</h1>
    
	<h2 id="creating-a-cluster-via-the-cli">Creating a Cluster via the CLI</h2>
<p>In this guide we will create an HA Kubernetes cluster with 1 worker node.
We assume existing <a href="https://docs.microsoft.com/en-us/azure/storage/blobs/">Blob Storage</a>, and some familiarity with Azure.
If you need more information on Azure specifics, please see the <a href="https://docs.microsoft.com/en-us/azure/">official Azure documentation</a>.</p>
<h3 id="environment-setup">Environment Setup</h3>
<p>We&rsquo;ll make use of the following environment variables throughout the setup.
Edit the variables below with your correct information.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Storage account to use</span>
<span style="color:#204a87">export</span> <span style="color:#000">STORAGE_ACCOUNT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;StorageAccountName&#34;</span>

<span style="color:#8f5902;font-style:italic"># Storage container to upload to</span>
<span style="color:#204a87">export</span> <span style="color:#000">STORAGE_CONTAINER</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;StorageContainerName&#34;</span>

<span style="color:#8f5902;font-style:italic"># Resource group name</span>
<span style="color:#204a87">export</span> <span style="color:#000">GROUP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ResourceGroupName&#34;</span>

<span style="color:#8f5902;font-style:italic"># Location</span>
<span style="color:#204a87">export</span> <span style="color:#000">LOCATION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;centralus&#34;</span>

<span style="color:#8f5902;font-style:italic"># Get storage account connection string based on info above</span>
<span style="color:#204a87">export</span> <span style="color:#000">CONNECTION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>az storage account show-connection-string <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    -n <span style="color:#000">$STORAGE_ACCOUNT</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    -o tsv<span style="color:#204a87;font-weight:bold">)</span>
</code></pre></div><h3 id="create-the-image">Create the Image</h3>
<p>First, download the Azure image from a <a href="https://github.com/talos-systems/talos/releases">Talos release</a>.
Once downloaded, untar with <code>tar -xvf /path/to/azure.tar.gz</code></p>
<h4 id="upload-the-vhd">Upload the VHD</h4>
<p>Once you have pulled down the image, you can upload it to blob storage with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">az storage blob upload <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --connection-string <span style="color:#000">$CONNECTION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --container-name <span style="color:#000">$STORAGE_CONTAINER</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -f /path/to/extracted/talos-azure.vhd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -n talos-azure.vhd
</code></pre></div><h4 id="register-the-image">Register the Image</h4>
<p>Now that the image is present in our blob storage, we&rsquo;ll register it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">az image create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --source https://<span style="color:#000">$STORAGE_ACCOUNT</span>.blob.core.windows.net/<span style="color:#000">$STORAGE_CONTAINER</span>/talos-azure.vhd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --os-type linux <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span>
</code></pre></div><h3 id="network-infrastructure">Network Infrastructure</h3>
<h4 id="virtual-networks-and-security-groups">Virtual Networks and Security Groups</h4>
<p>Once the image is prepared, we&rsquo;ll want to work through setting up the network.
Issue the following to create a network security group and add rules to it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Create vnet</span>
az network vnet create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --location <span style="color:#000">$LOCATION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-vnet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --subnet-name talos-subnet

<span style="color:#8f5902;font-style:italic"># Create network security group</span>
az network nsg create -g <span style="color:#000">$GROUP</span> -n talos-sg

<span style="color:#8f5902;font-style:italic"># Client -&gt; apid</span>
az network nsg rule create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --nsg-name talos-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -n apid <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --priority <span style="color:#0000cf;font-weight:bold">1001</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --destination-port-ranges <span style="color:#0000cf;font-weight:bold">50000</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --direction inbound

<span style="color:#8f5902;font-style:italic"># Trustd</span>
az network nsg rule create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --nsg-name talos-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -n trustd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --priority <span style="color:#0000cf;font-weight:bold">1002</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --destination-port-ranges <span style="color:#0000cf;font-weight:bold">50001</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --direction inbound

<span style="color:#8f5902;font-style:italic"># etcd</span>
az network nsg rule create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --nsg-name talos-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -n etcd <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --priority <span style="color:#0000cf;font-weight:bold">1003</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --destination-port-ranges 2379-2380 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --direction inbound

<span style="color:#8f5902;font-style:italic"># Kubernetes API Server</span>
az network nsg rule create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --nsg-name talos-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -n kube <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --priority <span style="color:#0000cf;font-weight:bold">1004</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --destination-port-ranges <span style="color:#0000cf;font-weight:bold">6443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --direction inbound
</code></pre></div><h4 id="load-balancer">Load Balancer</h4>
<p>We will create a public ip, load balancer, and a health check that we will use for our control plane.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Create public ip</span>
az network public-ip create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-public-ip <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --allocation-method static

<span style="color:#8f5902;font-style:italic"># Create lb</span>
az network lb create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-lb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --public-ip-address talos-public-ip <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --frontend-ip-name talos-fe <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --backend-pool-name talos-be-pool

<span style="color:#8f5902;font-style:italic"># Create health check</span>
az network lb probe create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --lb-name talos-lb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-lb-health <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --protocol tcp <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --port <span style="color:#0000cf;font-weight:bold">6443</span>

<span style="color:#8f5902;font-style:italic"># Create lb rule for 6443</span>
az network lb rule create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --lb-name talos-lb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-6443 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --protocol tcp <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --frontend-ip-name talos-fe <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --frontend-port <span style="color:#0000cf;font-weight:bold">6443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --backend-pool-name talos-be-pool <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --backend-port <span style="color:#0000cf;font-weight:bold">6443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --probe-name talos-lb-health
</code></pre></div><h4 id="network-interfaces">Network Interfaces</h4>
<p>In Azure, we have to pre-create the NICs for our control plane so that they can be associated with our load balancer.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87;font-weight:bold">for</span> i in <span style="color:#204a87;font-weight:bold">$(</span> seq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#204a87;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
  <span style="color:#8f5902;font-style:italic"># Create public IP for each nic</span>
  az network public-ip create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-controlplane-public-ip-<span style="color:#000">$i</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --allocation-method static


  <span style="color:#8f5902;font-style:italic"># Create nic</span>
  az network nic create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-controlplane-nic-<span style="color:#000">$i</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --vnet-name talos-vnet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --subnet talos-subnet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --network-security-group talos-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --public-ip-address talos-controlplane-public-ip-<span style="color:#000">$i</span><span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --lb-name talos-lb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --lb-address-pools talos-be-pool
<span style="color:#204a87;font-weight:bold">done</span>
</code></pre></div><h3 id="cluster-configuration">Cluster Configuration</h3>
<p>With our networking bits setup, we&rsquo;ll fetch the IP for our load balancer and create our configuration files.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">LB_PUBLIC_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>az network public-ip show <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --name talos-public-ip <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --query <span style="color:#ce5c00;font-weight:bold">[</span>ipAddress<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>              --output tsv<span style="color:#204a87;font-weight:bold">)</span>

talosctl gen config talos-k8s-azure-tutorial https://<span style="color:#4e9a06">${</span><span style="color:#000">LB_PUBLIC_IP</span><span style="color:#4e9a06">}</span>:6443
</code></pre></div><h3 id="compute-creation">Compute Creation</h3>
<p>We are now ready to create our azure nodes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Create availability set</span>
az vm availability-set create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-controlplane-av-set <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span>

<span style="color:#8f5902;font-style:italic"># Create controlplane 0</span>
az vm create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --name talos-controlplane-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --image talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --custom-data ./init.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --admin-username talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --generate-ssh-keys <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --verbose <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --boot-diagnostics-storage <span style="color:#000">$STORAGE_ACCOUNT</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --os-disk-size-gb <span style="color:#0000cf;font-weight:bold">20</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --nics talos-controlplane-nic-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --availability-set talos-controlplane-av-set <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --no-wait

<span style="color:#8f5902;font-style:italic"># Create 2 more controlplane nodes</span>
<span style="color:#204a87;font-weight:bold">for</span> i in <span style="color:#204a87;font-weight:bold">$(</span> seq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#204a87;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
  az vm create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-controlplane-<span style="color:#000">$i</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --custom-data ./controlplane.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --admin-username talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --generate-ssh-keys <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --verbose <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --boot-diagnostics-storage <span style="color:#000">$STORAGE_ACCOUNT</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --os-disk-size-gb <span style="color:#0000cf;font-weight:bold">20</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --nics talos-controlplane-nic-<span style="color:#000">$i</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --availability-set talos-controlplane-av-set <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --no-wait
<span style="color:#204a87;font-weight:bold">done</span>

<span style="color:#8f5902;font-style:italic"># Create worker node</span>
  az vm create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-worker-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --vnet-name talos-vnet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --subnet talos-subnet <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --custom-data ./join.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -g <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --admin-username talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --generate-ssh-keys <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --verbose <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --boot-diagnostics-storage <span style="color:#000">$STORAGE_ACCOUNT</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --nsg talos-sg <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --os-disk-size-gb <span style="color:#0000cf;font-weight:bold">20</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --no-wait

<span style="color:#8f5902;font-style:italic"># NOTES:</span>
<span style="color:#8f5902;font-style:italic"># `--admin-username` and `--generate-ssh-keys` are required by the az cli,</span>
<span style="color:#8f5902;font-style:italic"># but are not actually used by talos</span>
<span style="color:#8f5902;font-style:italic"># `--os-disk-size-gb` is the backing disk for Kubernetes and any workload containers</span>
<span style="color:#8f5902;font-style:italic"># `--boot-diagnostics-storage` is to enable console output which may be necessary</span>
<span style="color:#8f5902;font-style:italic"># for troubleshooting</span>
</code></pre></div><h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>You should now be able to interact with your cluster with <code>talosctl</code>.
We will need to discover the public IP for our first control plane node first.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">CONTROL_PLANE_0_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>az network public-ip show <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    --resource-group <span style="color:#000">$GROUP</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    --name talos-controlplane-public-ip-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    --query <span style="color:#ce5c00;font-weight:bold">[</span>ipAddress<span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                    --output tsv<span style="color:#204a87;font-weight:bold">)</span>
talosctl --talosconfig ./talosconfig config endpoint <span style="color:#000">$CONTROL_PLANE_0_IP</span>
talosctl --talosconfig ./talosconfig config node <span style="color:#000">$CONTROL_PLANE_0_IP</span>
talosctl --talosconfig ./talosconfig kubeconfig .
kubectl --kubeconfig ./kubeconfig get nodes
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-06c447084c1f167a44e6754bced0a1df">2.3 - DigitalOcean</h1>
    
	<h2 id="creating-a-cluster-via-the-cli">Creating a Cluster via the CLI</h2>
<p>In this guide we will create an HA Kubernetes cluster with 1 worker node.
We assume an existing <a href="https://www.digitalocean.com/docs/spaces/">Space</a>, and some familiarity with DigitalOcean.
If you need more information on DigitalOcean specifics, please see the <a href="https://www.digitalocean.com/docs/">official DigitalOcean documentation</a>.</p>
<h3 id="create-the-image">Create the Image</h3>
<p>First, download the DigitalOcean image from a Talos release.</p>
<p>Using an upload method of your choice (<code>doctl</code> does not have Spaces support), upload the image to a space.
Now, create an image using the URL of the uploaded image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute image create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image-name talos-digital-ocean-tutorial <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image-url https://talos-tutorial.<span style="color:#000">$REGION</span>.digitaloceanspaces.com/digital-ocean.raw.gz <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    Talos
</code></pre></div><p>Save the image ID.
We will need it when creating droplets.</p>
<h3 id="create-a-load-balancer">Create a Load Balancer</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute load-balancer create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name talos-digital-ocean-tutorial-lb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tag-name talos-digital-ocean-tutorial-control-plane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --health-check protocol:tcp,port:6443,check_interval_seconds:10,response_timeout_seconds:5,healthy_threshold:5,unhealthy_threshold:3 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --forwarding-rules entry_protocol:tcp,entry_port:443,target_protocol:tcp,target_port:6443
</code></pre></div><p>We will need the IP of the load balancer.
Using the ID of the load balancer, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute load-balancer get --format IP &lt;load balancer ID&gt;
</code></pre></div><p>Save it, as we will need it in the next step.</p>
<h3 id="create-the-machine-configuration-files">Create the Machine Configuration Files</h3>
<h4 id="generating-base-configurations">Generating Base Configurations</h4>
<p>Using the DNS name of the loadbalancer created earlier, generate the base configuration files for the Talos machines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl gen config talos-k8s-digital-ocean-tutorial https://&lt;load balancer IP or DNS&gt;:&lt;port&gt;
created init.yaml
created controlplane.yaml
created join.yaml
created talosconfig
</code></pre></div><p>At this point, you can modify the generated configs to your liking.</p>
<h4 id="validate-the-configuration-files">Validate the Configuration Files</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl validate --config init.yaml --mode cloud
init.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
$ talosctl validate --config controlplane.yaml --mode cloud
controlplane.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
$ talosctl validate --config join.yaml --mode cloud
join.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
</code></pre></div><h3 id="create-the-droplets">Create the Droplets</h3>
<h4 id="create-the-bootstrap-node">Create the Bootstrap Node</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute droplet create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image &lt;image ID&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --size s-2vcpu-4gb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --enable-private-networking <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tag-names talos-digital-ocean-tutorial-control-plane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data-file init.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --ssh-keys &lt;ssh key fingerprint&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    talos-control-plane-1
</code></pre></div><blockquote>
<p>Note: Although SSH is not used by Talos, DigitalOcean still requires that an SSH key be associated with the droplet.
Create a dummy key that can be used to satisfy this requirement.</p>
</blockquote>
<h4 id="create-the-remaining-control-plane-nodes">Create the Remaining Control Plane Nodes</h4>
<p>Run the following twice, to give ourselves three total control plane nodes:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute droplet create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image &lt;image ID&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --size s-2vcpu-4gb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --enable-private-networking <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tag-names talos-digital-ocean-tutorial-control-plane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data-file controlplane.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --ssh-keys &lt;ssh key fingerprint&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    talos-control-plane-2
doctl compute droplet create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image &lt;image ID&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --size s-2vcpu-4gb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --enable-private-networking <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tag-names talos-digital-ocean-tutorial-control-plane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data-file controlplane.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --ssh-keys &lt;ssh key fingerprint&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    talos-control-plane-3
</code></pre></div><h4 id="create-the-worker-nodes">Create the Worker Nodes</h4>
<p>Run the following to create a worker node:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute droplet create <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --region <span style="color:#000">$REGION</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image &lt;image ID&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --size s-2vcpu-4gb <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --enable-private-networking <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --user-data-file join.yaml <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --ssh-keys &lt;ssh key fingerprint&gt; <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    talos-worker-1
</code></pre></div><h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>To configure <code>talosctl</code> we will need the first control plane node&rsquo;s IP:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">doctl compute droplet get --format PublicIPv4 &lt;droplet ID&gt;
</code></pre></div><p>At this point we can retrieve the admin <code>kubeconfig</code> by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl --talosconfig talosconfig config endpoint &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig config node &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig kubeconfig .
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d786f979280314493c028c85305ceed0">2.4 - GCP</h1>
    
	<h2 id="creating-a-cluster-via-the-cli">Creating a Cluster via the CLI</h2>
<p>In this guide, we will create an HA Kubernetes cluster in GCP with 1 worker node.
We will assume an existing <a href="https://cloud.google.com/storage/docs/creating-buckets">Cloud Storage bucket</a>, and some familiarity with Google Cloud.
If you need more information on Google Cloud specifics, please see the <a href="https://cloud.google.com/docs/">official Google documentation</a>.</p>
<h3 id="environment-setup">Environment Setup</h3>
<p>We&rsquo;ll make use of the following environment variables throughout the setup.
Edit the variables below with your correct information.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Storage account to use</span>
<span style="color:#204a87">export</span> <span style="color:#000">STORAGE_BUCKET</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;StorageBucketName&#34;</span>
<span style="color:#8f5902;font-style:italic"># Region</span>
<span style="color:#204a87">export</span> <span style="color:#000">REGION</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;us-central1&#34;</span>
</code></pre></div><h3 id="create-the-image">Create the Image</h3>
<p>First, download the Google Cloud image from a Talos <a href="https://github.com/talos-systems/talos/releases">release</a>.
These images are called <code>gcp.tar.gz</code>.</p>
<h4 id="upload-the-image">Upload the Image</h4>
<p>Once you have downloaded the image, you can upload it to your storage bucket with:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gsutil cp /path/to/gcp.tar.gz gs://<span style="color:#000">$STORAGE_BUCKET</span>
</code></pre></div><h4 id="register-the-image">Register the image</h4>
<p>Now that the image is present in our bucket, we&rsquo;ll register it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gcloud compute images create talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span> --source-uri<span style="color:#ce5c00;font-weight:bold">=</span>gs://<span style="color:#000">$STORAGE_BUCKET</span>/gcp.tar.gz <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span> --guest-os-features<span style="color:#ce5c00;font-weight:bold">=</span>VIRTIO_SCSI_MULTIQUEUE
</code></pre></div><h3 id="network-infrastructure">Network Infrastructure</h3>
<h4 id="load-balancers-and-firewalls">Load Balancers and Firewalls</h4>
<p>Once the image is prepared, we&rsquo;ll want to work through setting up the network.
Issue the following to create a firewall, load balancer, and their required components.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Create Instance Group</span>
gcloud compute instance-groups unmanaged create talos-ig <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --zone <span style="color:#000">$REGION</span>-b

<span style="color:#8f5902;font-style:italic"># Create port for IG</span>
gcloud compute instance-groups set-named-ports talos-ig <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --named-ports tcp6443:6443 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --zone <span style="color:#000">$REGION</span>-b

<span style="color:#8f5902;font-style:italic"># Create health check</span>
gcloud compute health-checks create tcp talos-health-check --port <span style="color:#0000cf;font-weight:bold">6443</span>

<span style="color:#8f5902;font-style:italic"># Create backend</span>
gcloud compute backend-services create talos-be <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --global <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --protocol TCP <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --health-checks talos-health-check <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --timeout 5m <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --port-name tcp6443

<span style="color:#8f5902;font-style:italic"># Add instance group to backend</span>
gcloud compute backend-services add-backend talos-be <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --global <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --instance-group talos-ig <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --instance-group-zone <span style="color:#000">$REGION</span>-b

<span style="color:#8f5902;font-style:italic"># Create tcp proxy</span>
gcloud compute target-tcp-proxies create talos-tcp-proxy <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --backend-service talos-be <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --proxy-header NONE

<span style="color:#8f5902;font-style:italic"># Create LB IP</span>
gcloud compute addresses create talos-lb-ip --global

<span style="color:#8f5902;font-style:italic"># Forward 443 from LB IP to tcp proxy</span>
gcloud compute forwarding-rules create talos-fwd-rule <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --global <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --ports <span style="color:#0000cf;font-weight:bold">443</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --address talos-lb-ip <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --target-tcp-proxy talos-tcp-proxy

<span style="color:#8f5902;font-style:italic"># Create firewall rule for health checks</span>
 gcloud compute firewall-rules create talos-controlplane-firewall <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>     --source-ranges 130.211.0.0/22,35.191.0.0/16 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>     --target-tags talos-controlplane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>     --allow tcp:6443

<span style="color:#8f5902;font-style:italic"># Create firewall rule to allow talosctl access</span>
gcloud compute firewall-rules create talos-controlplane-talosctl <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --source-ranges 0.0.0.0/0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --target-tags talos-controlplane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --allow tcp:50000
</code></pre></div><h3 id="cluster-configuration">Cluster Configuration</h3>
<p>With our networking bits setup, we&rsquo;ll fetch the IP for our load balancer and create our configuration files.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">LB_PUBLIC_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>gcloud compute forwarding-rules describe talos-fwd-rule <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>               --global <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>               --format json <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>               <span style="color:#000;font-weight:bold">|</span> jq -r .IPAddress<span style="color:#204a87;font-weight:bold">)</span>

talosctl gen config talos-k8s-gcp-tutorial https://<span style="color:#4e9a06">${</span><span style="color:#000">LB_PUBLIC_IP</span><span style="color:#4e9a06">}</span>:443
</code></pre></div><h3 id="compute-creation">Compute Creation</h3>
<p>We are now ready to create our azure nodes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8f5902;font-style:italic"># Create control plane 0</span>
gcloud compute instances create talos-controlplane-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --image talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --zone <span style="color:#000">$REGION</span>-b <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --tags talos-controlplane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --boot-disk-size 20GB <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --metadata-from-file<span style="color:#ce5c00;font-weight:bold">=</span>user-data<span style="color:#ce5c00;font-weight:bold">=</span>./init.yaml

<span style="color:#8f5902;font-style:italic"># Create control plane 1/2</span>
<span style="color:#204a87;font-weight:bold">for</span> i in <span style="color:#204a87;font-weight:bold">$(</span> seq <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#204a87;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
  gcloud compute instances create talos-controlplane-<span style="color:#000">$i</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --image talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --zone <span style="color:#000">$REGION</span>-b <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --tags talos-controlplane <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --boot-disk-size 20GB <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --metadata-from-file<span style="color:#ce5c00;font-weight:bold">=</span>user-data<span style="color:#ce5c00;font-weight:bold">=</span>./controlplane.yaml
<span style="color:#204a87;font-weight:bold">done</span>

<span style="color:#8f5902;font-style:italic"># Add control plane nodes to instance group</span>
<span style="color:#204a87;font-weight:bold">for</span> i in <span style="color:#204a87;font-weight:bold">$(</span> seq <span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#204a87;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">do</span>
  gcloud compute instance-groups unmanaged add-instances talos-ig <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>      --zone <span style="color:#000">$REGION</span>-b <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>      --instances talos-controlplane-<span style="color:#000">$i</span>
<span style="color:#204a87;font-weight:bold">done</span>

<span style="color:#8f5902;font-style:italic"># Create worker</span>
gcloud compute instances create talos-worker-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --image talos <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --zone <span style="color:#000">$REGION</span>-b <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --boot-disk-size 20GB <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --metadata-from-file<span style="color:#ce5c00;font-weight:bold">=</span>user-data<span style="color:#ce5c00;font-weight:bold">=</span>./join.yaml
</code></pre></div><h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>You should now be able to interact with your cluster with <code>talosctl</code>.
We will need to discover the public IP for our first control plane node first.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#000">CONTROL_PLANE_0_IP</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>gcloud compute instances describe talos-controlplane-0 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                     --zone <span style="color:#000">$REGION</span>-b <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                     --format json <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>                     <span style="color:#000;font-weight:bold">|</span> jq -r <span style="color:#4e9a06">&#39;.networkInterfaces[0].accessConfigs[0].natIP&#39;</span><span style="color:#204a87;font-weight:bold">)</span>

talosctl --talosconfig ./talosconfig config endpoint <span style="color:#000">$CONTROL_PLANE_0_IP</span>
talosctl --talosconfig ./talosconfig config node <span style="color:#000">$CONTROL_PLANE_0_IP</span>
talosctl --talosconfig ./talosconfig kubeconfig .
kubectl --kubeconfig ./kubeconfig get nodes
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d2c6535126cca927d2a9c893abde92a0">3 - Gides</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-c281f9289754089f3fbb34f422ac4b71">3.1 - Advanced Networking</h1>
    
	<h2 id="static-addressing">Static Addressing</h2>
<p>Static addressing is comprised of specifying <code>cidr</code>, <code>routes</code> ( remember to add your default gateway ), and <code>interface</code>.
Most likely you&rsquo;ll also want to define the <code>nameservers</code> so you have properly functioning DNS.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">hostname</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">talos</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">nameservers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#0000cf;font-weight:bold">10.0.0.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">time.cloudflare.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cidr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.0.0.201</span><span style="color:#000">/8</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">mtu</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">8765</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">routes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.0.0.0</span><span style="color:#000">/0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">gateway</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.0.0.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">ignore</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="additional-addresses-for-an-interface">Additional Addresses for an Interface</h2>
<p>In some environments you may need to set additional addresses on an interface.
In the following example, we set two additional addresses on the loopback interface.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">lo0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cidr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">192.168.0.21</span><span style="color:#000">/24</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">lo0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cidr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10.2.2.2</span><span style="color:#000">/24</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="bonding">Bonding</h2>
<p>The following example shows how to create a bonded interface.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bond0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dhcp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">bond</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">802.</span><span style="color:#000">3ad</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">lacpRate</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">fast</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">xmitHashPolicy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">layer3+4</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">miimon</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">updelay</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">200</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">downdelay</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">200</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">eth0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">eth1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="vlans">VLANs</h2>
<p>To setup vlans on a specific device use an array of VLANs to add.
The master device may be configured without addressing by setting dhcp to false.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">interface</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">eth0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">dhcp</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">vlans</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span>- <span style="color:#204a87;font-weight:bold">vlanId</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">100</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">cidr</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;192.168.2.10/28&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span><span style="color:#204a87;font-weight:bold">routes</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">              </span>- <span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0.0.0.0</span><span style="color:#000">/0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">                </span><span style="color:#204a87;font-weight:bold">gateway</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">192.168.2.1</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2c37d55bff1b34046a01607cb81e21dc">3.2 - Configuring Containerd</h1>
    
	<p>The base containerd configuration expects to merge in any additional configs present in <code>/var/cri/conf.d/*.toml</code>.</p>
<h2 id="an-example-of-exposing-metrics">An example of exposing metrics</h2>
<p>Into each machine config, add the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">content</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">        [metrics]
</span><span style="color:#8f5902;font-style:italic">          address = &#34;0.0.0.0:11234&#34;</span><span style="color:#f8f8f8;text-decoration:underline">        
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/cri/conf.d/metrics.toml</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Create cluster like normal and see that metrics are now present on this port:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl 127.0.0.1:11234/v1/metrics
<span style="color:#8f5902;font-style:italic"># HELP container_blkio_io_service_bytes_recursive_bytes The blkio io service bytes recursive</span>
<span style="color:#8f5902;font-style:italic"># TYPE container_blkio_io_service_bytes_recursive_bytes gauge</span>
container_blkio_io_service_bytes_recursive_bytes<span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#000">container_id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;0677d73196f5f4be1d408aab1c4125cf9e6c458a4bea39e590ac779709ffbe14&#34;</span>,device<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/dev/dm-0&#34;</span>,major<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;253&#34;</span>,minor<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;0&#34;</span>,namespace<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;k8s.io&#34;</span>,op<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Async&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#0000cf;font-weight:bold">0</span>
container_blkio_io_service_bytes_recursive_bytes<span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#000">container_id</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;0677d73196f5f4be1d408aab1c4125cf9e6c458a4bea39e590ac779709ffbe14&#34;</span>,device<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/dev/dm-0&#34;</span>,major<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;253&#34;</span>,minor<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;0&#34;</span>,namespace<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;k8s.io&#34;</span>,op<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Discard&#34;</span><span style="color:#ce5c00;font-weight:bold">}</span> <span style="color:#0000cf;font-weight:bold">0</span>
...
...
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2f14629b161e61b1637fade69b2bae91">3.3 - Configuring Corporate Proxies</h1>
    
	<h2 id="appending-the-certificate-authority-of-mitm-proxies">Appending the Certificate Authority of MITM Proxies</h2>
<p>Put into each machine the PEM encoded certificate:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#204a87;font-weight:bold">content</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">        -----BEGIN CERTIFICATE-----
</span><span style="color:#8f5902;font-style:italic">        ...
</span><span style="color:#8f5902;font-style:italic">        -----END CERTIFICATE-----</span><span style="color:#f8f8f8;text-decoration:underline">        
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">permissions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0644</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/etc/ssl/certs/ca-certificates</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">append</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h2 id="configuring-a-machine-to-use-the-proxy">Configuring a Machine to Use the Proxy</h2>
<p>To make use of a proxy:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">http_proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;http proxy&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">https_proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;https proxy&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">no_proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;no proxy&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Additionally, configure the DNS <code>nameservers</code>, and NTP <code>servers</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">&lt;server 1&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">&lt;server ...&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">&lt;server n&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">nameservers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">&lt;ip 1&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">&lt;ip ...&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">&lt;ip n&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-88e87571b8b84ca8840f0ce75e87ee6c">3.4 - Configuring Pull Through Cache</h1>
    
	<p>In this guide we will create a set of local caching Docker registry proxies to minimize local cluster startup time.</p>
<p>When running Talos locally, pulling images from Docker registries might take a significant amount of time.
We spin up local caching pass-through registries to cache images and configure a local Talos cluster to use those proxies.
A similar approach might be used to run Talos in production in air-gapped environments.
It can be also used to verify that all the images are available in local registries.</p>
<h2 id="video-walkthrough">Video Walkthrough</h2>
<p>To see a live demo of this writeup, see the video below:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/PRiQJR9Q33s" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="requirements">Requirements</h2>
<p>The follow are requirements for creating the set of caching proxies:</p>
<ul>
<li>Docker 18.03 or greater</li>
<li>Local cluster requirements for either <a href="docker">docker</a> or <a href="firecracker">fireracker</a>.</li>
</ul>
<h2 id="launch-the-caching-docker-registry-proxies">Launch the Caching Docker Registry Proxies</h2>
<p>Talos pulls from <code>docker.io</code>, <code>k8s.gcr.io</code>, <code>gcr.io</code> and <code>quay.io</code> by default.
If your configuration is different, you might need to modify the commands below:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -d -p 5000:5000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">REGISTRY_PROXY_REMOTEURL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://registry-1.docker.io <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --restart always <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name registry-docker.io registry:2

docker run -d -p 5001:5000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">REGISTRY_PROXY_REMOTEURL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://k8s.gcr.io <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --restart always <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name registry-k8s.gcr.io registry:2

docker run -d -p 5002:5000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">REGISTRY_PROXY_REMOTEURL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://quay.io <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --restart always <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name registry-quay.io registry:2.5

docker run -d -p 5003:5000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    -e <span style="color:#000">REGISTRY_PROXY_REMOTEURL</span><span style="color:#ce5c00;font-weight:bold">=</span>https://gcr.io <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --restart always <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --name registry-gcr.io registry:2
</code></pre></div><blockquote>
<p>Note: Proxies are started as docker containers, and they&rsquo;re automatically configured to start with Docker daemon.
Please note that <code>quay.io</code> proxy doesn&rsquo;t support recent Docker image schema, so we run older registry image version (2.5).</p>
</blockquote>
<p>As a registry container can only handle a single upstream Docker registry, we launch a container per upstream, each on its own
host port (5000, 5001, 5002).</p>
<h2 id="using-caching-registries-with-firecracker-local-cluster">Using Caching Registries with <code>firecracker</code> Local Cluster</h2>
<p>With a <a href="firecracker">firecracker</a> local cluster, a bridge interface is created on the host.
As registry containers expose their ports on the host, we can use bridge IP to direct proxy requests.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo talosctl cluster create --provisioner firecracker <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror docker.io<span style="color:#ce5c00;font-weight:bold">=</span>http://10.5.0.1:5000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror k8s.gcr.io<span style="color:#ce5c00;font-weight:bold">=</span>http://10.5.0.1:5001 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror quay.io<span style="color:#ce5c00;font-weight:bold">=</span>http://10.5.0.1:5002 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror gcr.io<span style="color:#ce5c00;font-weight:bold">=</span>http://10.5.0.1:5003
</code></pre></div><p>The Talos local cluster should now start pulling via caching registries.
This can be verified via registry logs, e.g. <code>docker logs -f registry-docker.io</code>.
The first time cluster boots, images are pulled and cached, so next cluster boot should be much faster.</p>
<blockquote>
<p>Note: <code>10.5.0.1</code> is a bridge IP with default network (<code>10.5.0.0/24</code>), if using custom <code>--cidr</code>, value should be adjusted accordingly.</p>
</blockquote>
<h2 id="using-caching-registries-with-docker-local-cluster">Using Caching Registries with <code>docker</code> Local Cluster</h2>
<p>With a <a href="docker">docker</a> local cluster we can use docker bridge IP, default value for that IP is <code>172.17.0.1</code>.
On Linux, the docker bridge address can be inspected with <code>ip addr show docker0</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl cluster create --provisioner docker <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror docker.io<span style="color:#ce5c00;font-weight:bold">=</span>http://172.17.0.1:5000 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror k8s.gcr.io<span style="color:#ce5c00;font-weight:bold">=</span>http://172.17.0.1:5001 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror quay.io<span style="color:#ce5c00;font-weight:bold">=</span>http://172.17.0.1:5002 <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>    --registry-mirror gcr.io<span style="color:#ce5c00;font-weight:bold">=</span>http://172.17.0.1:5003
</code></pre></div><h2 id="cleaning-up">Cleaning Up</h2>
<p>To cleanup, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker rm -f registry-docker.io
docker rm -f registry-k8s.gcr.io
docker rm -f registry-quay.io
docker rm -f registry-gcr.io
</code></pre></div><blockquote>
<p>Note: Removing docker registry containers also removes the image cache.
So if you plan to use caching registries, keep the containers running.</p>
</blockquote>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-07c8bd101e3aa1d4dfdf920a1ec11447">3.5 - Configuring the Cluster Endpoint</h1>
    
	<p>In this section, we will step through the configuration of a Talos based Kubernetes cluster.
There are three major components we will configure:</p>
<ul>
<li><code>apid</code> and <code>talosctl</code></li>
<li>the master nodes</li>
<li>the worker nodes</li>
</ul>
<p>Talos enforces a high level of security by using mutual TLS for authentication and authorization.</p>
<p>We recommend that the configuration of Talos be performed by a cluster owner.
A cluster owner should be a person of authority within an organization, perhaps a director, manager, or senior member of a team.
They are responsible for storing the root CA, and distributing the PKI for authorized cluster administrators.</p>
<h3 id="recommended-settings">Recommended settings</h3>
<p>Talos runs great out of the box, but if you tweak some minor settings it will make your life
a lot easier in the future.
This is not a requirement, but rather a document to explain some key settings.</p>
<h4 id="endpoint">Endpoint</h4>
<p>To configure the <code>talosctl</code> endpoint, it is recommended you use a resolvable DNS name.
This way, if you decide to upgrade to a multi-controlplane cluster you only have to add the ip adres to the hostname configuration.
The configuration can either be done on a Loadbalancer, or simply trough DNS.</p>
<p>For example:</p>
<blockquote>
<p>This is in the config file for the cluster e.g. init.yaml, controlplane.yaml and join.yaml.
for more details, please see: <a href="https://www.talos.dev/docs/v0.6/en/configuration/v1alpha1#controlplane">v1alpha1 endpoint configuration</a></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">...</span><span style="color:#000">..</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">controlPlane</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://endpoint.example.local:6443</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#000">..</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>If you have a DNS name as the endpoint, you can upgrade your talos cluster with multiple controlplanes in the future (if you don&rsquo;t have a multi-controlplane setup from the start)
Using a DNS name generates the corresponding Certificates (Kubernetes and Talos) for the correct hostname.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d4c3bffeb2b85220403773327181707e">3.6 - Customizing the Kernel</h1>
    
	<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#4e9a06"> scratch AS customization</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">COPY</span> --from<span style="color:#ce5c00;font-weight:bold">=</span>&lt;custom kernel image&gt; /lib/modules /lib/modules<span style="color:#a40000">
</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#4e9a06"> docker.io/andrewrynhard/installer:latest</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">COPY</span> --from<span style="color:#ce5c00;font-weight:bold">=</span>&lt;custom kernel image&gt; /boot/vmlinuz /usr/install/vmlinuz<span style="color:#a40000">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build --build-arg <span style="color:#000">RM</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;/lib/modules&#34;</span> -t talos-installer .
</code></pre></div><blockquote>
<p>Note: You can use the <code>--squash</code> flag to create smaller images.</p>
</blockquote>
<p>Now that we have a custom installer we can build Talos for the specific platform we wish to deploy to.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-154cfa2281a3a1ec2677e0d27b6d632c">3.7 - Customizing the Root Filesystem</h1>
    
	<p>The installer image contains <a href="https://docs.docker.com/engine/reference/builder/#onbuild"><code>ONBUILD</code></a> instructions that handle the following:</p>
<ul>
<li>the decompression, and unpacking of the <code>initramfs.xz</code></li>
<li>the unsquashing of the rootfs</li>
<li>the copying of new rootfs files</li>
<li>the squashing of the new rootfs</li>
<li>and the packing, and compression of the new <code>initramfs.xz</code></li>
</ul>
<p>When used as a base image, the installer will perform the above steps automatically with the requirement that a <code>customization</code> stage be defined in the <code>Dockerfile</code>.</p>
<p>For example, say we have an image that contains the contents of a library we wish to add to the Talos rootfs.
We need to define a stage with the name <code>customization</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#4e9a06"> scratch AS customization</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">COPY</span> --from<span style="color:#ce5c00;font-weight:bold">=</span>&lt;name<span style="color:#000;font-weight:bold">|</span>index&gt; &lt;src&gt; &lt;dest&gt;<span style="color:#a40000">
</span></code></pre></div><p>Using a multi-stage <code>Dockerfile</code> we can define the <code>customization</code> stage and build <code>FROM</code> the installer image:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#4e9a06"> scratch AS customization</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">COPY</span> --from<span style="color:#ce5c00;font-weight:bold">=</span>&lt;name<span style="color:#000;font-weight:bold">|</span>index&gt; &lt;src&gt; &lt;dest&gt;<span style="color:#a40000">
</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">FROM</span><span style="color:#4e9a06"> docker.io/autonomy/installer:latest</span><span style="color:#a40000">
</span></code></pre></div><p>When building the image, the <code>customization</code> stage will automatically be copied into the rootfs.
The <code>customization</code> stage is not limited to a single <code>COPY</code> instruction.
In fact, you can do whatever you would like in this stage, but keep in mind that everything in <code>/</code> will be copied into the rootfs.</p>
<blockquote>
<p>Note: <code>&lt;dest&gt;</code> is the path relative to the rootfs that you wish to place the contents of <code>&lt;src&gt;</code>.</p>
</blockquote>
<p>To build the image, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build --squash -t &lt;organization&gt;/installer:latest .
</code></pre></div><p>In the case that you need to perform some cleanup <em>before</em> adding additional files to the rootfs, you can specify the <code>RM</code> <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg">build-time variable</a>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build --squash --build-arg <span style="color:#000">RM</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;[&lt;path&gt; ...]&#34;</span> -t &lt;organization&gt;/installer:latest .
</code></pre></div><p>This will perform a <code>rm -rf</code> on the specified paths relative to the rootfs.</p>
<blockquote>
<p>Note: <code>RM</code> must be a whitespace delimited list.</p>
</blockquote>
<p>The resulting image can be used to:</p>
<ul>
<li>generate an image for any of the supported providers</li>
<li>perform bare-metall installs</li>
<li>perform upgrades</li>
</ul>
<p>We will step through common customizations in the remainder of this section.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-6c53eb082db3ba8b955139d995481c8b">3.8 - Managing PKI</h1>
    
	<h2 id="generating-an-administrator-key-pair">Generating an Administrator Key Pair</h2>
<p>In order to create a key pair, you will need the root CA.</p>
<p>Save the the CA public key, and CA private key as <code>ca.crt</code>, and <code>ca.key</code> respectively.
Now, run the following commands to generate a certificate:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl gen key --name admin
talosctl gen csr --key admin.key --ip 127.0.0.1
talosctl gen crt --ca ca --csr admin.csr --name admin
</code></pre></div><p>Now, base64 encode <code>admin.crt</code>, and <code>admin.key</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat admin.crt <span style="color:#000;font-weight:bold">|</span> base64
cat admin.key <span style="color:#000;font-weight:bold">|</span> base64
</code></pre></div><p>You can now set the <code>crt</code> and <code>key</code> fields in the <code>talosconfig</code> to the base64 encoded strings.</p>
<h2 id="renewing-an-expired-administrator-certificate">Renewing an Expired Administrator Certificate</h2>
<p>In order to renew the certificate, you will need the root CA, and the admin private key.
The base64 encoded key can be found in any one of the control plane node&rsquo;s configuration file.
Where it is exactly will depend on the specific version of the configuration file you are using.</p>
<p>Save the the CA public key, CA private key, and admin private key as <code>ca.crt</code>, <code>ca.key</code>, and <code>admin.key</code> respectively.
Now, run the following commands to generate a certificate:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl gen csr --key admin.key --ip 127.0.0.1
talosctl gen crt --ca ca --csr admin.csr --name admin
</code></pre></div><p>You should see <code>admin.crt</code> in your current directory.
Now, base64 encode <code>admin.crt</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat admin.crt <span style="color:#000;font-weight:bold">|</span> base64
</code></pre></div><p>You can now set the certificate in the <code>talosconfig</code> to the base64 encoded string.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7b65b067e7f3a1d78f9acdfb89730023">3.9 - Resetting a Machine</h1>
    
	<p>From time to time, it may be beneficial to reset a Talos machine to its &ldquo;original&rdquo; state.
Bear in mind that this is a destructive action for the given machine.
Doing this means removing the machine from Kubernetes, Etcd (if applicable), and clears any data on the machine that would normally persist a reboot.</p>
<p>The API command for doing this is <code>talosctl reset</code>.
There are a couple of flags as part of this command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Flags:
      --graceful   <span style="color:#204a87;font-weight:bold">if</span> true, attempt to cordon/drain node and leave etcd <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">if</span> applicable<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">(</span>default <span style="color:#204a87">true</span><span style="color:#ce5c00;font-weight:bold">)</span>
      --reboot     <span style="color:#204a87;font-weight:bold">if</span> true, reboot the node after resetting instead of shutting down
</code></pre></div><p>The <code>graceful</code> flag is especially important when considering HA vs. non-HA Talos clusters.
If the machine is part of an HA cluster, a normal, graceful reset should work just fine right out of the box as long as the cluster is in a good state.
However, if this is a single node cluster being used for testing purposes, a graceful reset is not an option since Etcd cannot be &ldquo;left&rdquo; if there is only a single member.
In this case, reset should be used with <code>--graceful=false</code> to skip performing checks that would normally block the reset.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1725f639c2964c56ab86e6391b52a6a6">3.10 - Upgrading Kubernetes</h1>
    
	<h2 id="video-walkthrough">Video Walkthrough</h2>
<p>To see a live demo of this writeup, see the video below:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/sw78qS8vBGc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="kubelet-image">Kubelet Image</h2>
<p>In Kubernetes 1.19, the official <code>hyperkube</code> image was removed.
This means that in order to upgrade Kubernetes, Talos users will have to change the <code>command</code>, and <code>image</code> fields of each control plane component.
The <code>kubelet</code> image will also have to be updated, if you wish to specify the <code>kubelet</code> image explicitly.
The default used by Talos is sufficient in most cases.</p>
<h2 id="kubeconfig">Kubeconfig</h2>
<p>In order to edit the control plane, we will need a working <code>kubectl</code> config.
If you don&rsquo;t already have one, you can get one by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl --nodes &lt;master node&gt; kubeconfig
</code></pre></div><h3 id="automated-kubernetes-upgrade">Automated Kubernetes Upgrade</h3>
<p>In Talos v0.6.1 we introduced the <code>upgrade-k8s</code> command in <code>talosctl</code>.
This command can be used to automate the Kubernetes upgrade process.
For example, to upgrade from Kubernetes v1.18.6 to v1.19.0 run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl --nodes &lt;master node&gt; upgrade-k8s --from 1.18.6 --to 1.19.0
updating pod-checkpointer grace period to <span style="color:#4e9a06">&#34;0m&#34;</span>
sleeping 5m0s to <span style="color:#204a87">let</span> the pod-checkpointer self-checkpoint be updated
temporarily taking <span style="color:#4e9a06">&#34;kube-apiserver&#34;</span> out of pod-checkpointer control
updating daemonset <span style="color:#4e9a06">&#34;kube-apiserver&#34;</span> to version <span style="color:#4e9a06">&#34;1.19.0&#34;</span>
updating daemonset <span style="color:#4e9a06">&#34;kube-controller-manager&#34;</span> to version <span style="color:#4e9a06">&#34;1.19.0&#34;</span>
updating daemonset <span style="color:#4e9a06">&#34;kube-scheduler&#34;</span> to version <span style="color:#4e9a06">&#34;1.19.0&#34;</span>
updating daemonset <span style="color:#4e9a06">&#34;kube-proxy&#34;</span> to version <span style="color:#4e9a06">&#34;1.19.0&#34;</span>
updating pod-checkpointer grace period to <span style="color:#4e9a06">&#34;5m0s&#34;</span>
</code></pre></div><h3 id="manual-kubernetes-upgrade">Manual Kubernetes Upgrade</h3>
<p>Kubernetes can be upgraded manually as well by following the steps outlined below.
They are equivalent to the steps performed by the <code>talosctl upgrade-k8s</code> command.</p>
<h4 id="pod-checkpointer">pod-checkpointer</h4>
<p>Talos runs <code>pod-checkpointer</code> component which helps to recover control plane components (specifically, API server) if control plane is not healthy.</p>
<p>However, the way checkpoints interact with API server upgrade may make an upgrade take a lot longer due to a race condition on API server listen port.</p>
<p>In order to speed up upgrades, first lower <code>pod-checkpointer</code> grace period to zero (<code>kubectl -n kube-system edit daemonset pod-checkpointer</code>), change:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod-checkpointer</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- --<span style="color:#000">checkpoint-grace-period=5m0s</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>to:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod-checkpointer</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- --<span style="color:#000">checkpoint-grace-period=0s</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>Wait for 5 minutes to let <code>pod-checkpointer</code> update self-checkpoint to the new grace period.</p>
<h4 id="api-server">API Server</h4>
<p>In the API server&rsquo;s <code>DaemonSet</code>, change:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">./hyperkube</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">kube-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>to:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s.gcr.io/kube-apiserver:v1.19.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">/go-runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">/usr/local/bin/kube-apiserver</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>To edit the <code>DaemonSet</code>, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl edit daemonsets -n kube-system kube-apiserver
</code></pre></div><h4 id="controller-manager">Controller Manager</h4>
<p>In the controller manager&rsquo;s <code>DaemonSet</code>, change:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-controller-manager</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">./hyperkube</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">kube-controller-manager</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>to:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-controller-manager</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s.gcr.io/kube-controller-manager:v1.19.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">/go-runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">/usr/local/bin/kube-controller-manager</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>To edit the <code>DaemonSet</code>, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl edit daemonsets -n kube-system kube-controller-manager
</code></pre></div><h4 id="scheduler">Scheduler</h4>
<p>In the scheduler&rsquo;s <code>DaemonSet</code>, change:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">./hyperkube</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>to:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">kube-sceduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">k8s.gcr.io/kube-scheduler:v1.19.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">          </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">/go-runner</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">            </span>- <span style="color:#000">/usr/local/bin/kube-scheduler</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>To edit the <code>DaemonSet</code>, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl edit daemonsets -n kube-system kube-scheduler
</code></pre></div><h4 id="restoring-pod-checkpointer">Restoring pod-checkpointer</h4>
<p>Restore grace period of 5 minutes (<code>kubectl -n kube-system edit daemonset pod-checkpointer</code>), change:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod-checkpointer</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- --<span style="color:#000">checkpoint-grace-period=0s</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><p>to:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kind</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">DaemonSet</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">template</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">containers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">pod-checkpointer</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">command</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- --<span style="color:#000">checkpoint-grace-period=5m0s</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="kubelet">Kubelet</h3>
<p>The Talos team now maintains an image for the <code>kubelet</code> that should be used starting with Kubernetes 1.19.
The image for this release is <code>docker.io/autonomy/kubelet:v1.19.0</code>.
To explicitly set the image, we can use the <a href="https://www.talos.dev/docs/v0.6/en/configuration/v1alpha1#kubelet">official documentation</a>.
For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">kubelet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">docker.io/autonomy/kubelet:v1.19.0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d9842e6290a13813a9a577de45cbca25">3.11 - Upgrading Talos</h1>
    
	<h2 id="video-walkthrough">Video Walkthrough</h2>
<p>To see a live demo of this writeup, see the video below:</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/sw78qS8vBGc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<h2 id="talos">Talos</h2>
<p>In an effort to create more production ready clusters, Talos will now taint control plane nodes as unschedulable.
This means that any application you might have deployed must tolerate this taint if you intend on running the application on control plane nodes.</p>
<p>Another feature you will notice is the automatic uncordoning of nodes that have been upgraded.
Talos will now uncordon a node if the cordon was initiated by the upgrade process.</p>
<h2 id="talosctl">Talosctl</h2>
<p>The <code>talosctl</code> CLI now requires an explicit set of nodes.
This can be configured with <code>talos config nodes</code> or set on the fly with <code>talos --nodes</code>.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d1742b0a409facb9dc9b2828826c6df3">4 - Introduction</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-d4ee8bb096719d6becadaaf818c47610">4.1 - What is Talos?</h1>
    
	<p>Talos is an open source platform to host and maintain Kubernetes clusters.
It includes a purpose-built operating system and associated management tools.
It can run on all major cloud providers, virtualization platforms, and bare metal hardware.</p>
<p>All system management is done via an API, and there is no shell or interactive console.
Some of the capabilities and benefits provided by Talos include:</p>
<ul>
<li><strong>Security</strong>: Talos reduces your attack surface by practicing the Principle of Least Privilege (PoLP) and by securing the API with mutual TLS (mTLS) authentication.</li>
<li><strong>Predictability</strong>: Talos eliminates unneeded variables and reduces unknown factors in your environment by employing immutable infrastructure ideology.</li>
<li><strong>Evolvability</strong>: Talos simplifies your architecture and increases your ability to easily accommodate future changes.</li>
</ul>
<p>Talos is flexible and can be deployed in a variety of ways, but the easiest way to get started and experiment with the system is to run a local cluster on your laptop or workstation.
There are two options:</p>
<ul>
<li><a href="/docs/v0.6/local-platforms/docker/">Run a Docker-based local cluster</a> on your Linux or Mac workstation</li>
<li><a href="/docs/v0.6/local-platforms/docker/">Run a Firecracker micro-VM-based</a> cluster on your Linux workstation</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-81d9f057f563127c5d467a780c68346e">4.2 - Quickstart</h1>
    
	<p>In this guide we will create a Kubernetes cluster in Docker, using a containerized version of Talos.</p>
<p>Running Talos in Docker is intended to be used in CI pipelines, and local testing when you need a quick and easy cluster.
Furthermore, if you are running Talos in production, it provides an excellent way for developers to develop against the same version of Talos.</p>
<h2 id="requirements">Requirements</h2>
<p>The follow are requirements for running Talos in Docker:</p>
<ul>
<li>Docker 18.03 or greater</li>
<li>a recent version of <a href="https://github.com/talos-systems/talos/releases"><code>talosctl</code></a></li>
</ul>
<h2 id="create-the-cluster">Create the Cluster</h2>
<p>Creating a local cluster is as simple as:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl cluster create --wait
</code></pre></div><p>Once the above finishes successfully, your talosconfig(<code>~/.talos/config</code>) will be configured to point to the new cluster.</p>
<p>If you are running on MacOS, an additional command is required:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl config --endpoints 127.0.0.1
</code></pre></div><blockquote>
<p>Note: Startup times can take up to a minute before the cluster is available.</p>
</blockquote>
<h2 id="retrieve-and-configure-the-kubeconfig">Retrieve and Configure the <code>kubeconfig</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl kubeconfig .
kubectl --kubeconfig kubeconfig config set-cluster talos-default --server https://127.0.0.1:6443
</code></pre></div><h2 id="using-the-cluster">Using the Cluster</h2>
<p>Once the cluster is available, you can make use of <code>talosctl</code> and <code>kubectl</code> to interact with the cluster.
For example, to view current running containers, run <code>talosctl containers</code> for a list of containers in the <code>system</code> namespace, or <code>talosctl containers -k</code> for the <code>k8s.io</code> namespace.
To view the logs of a container, use <code>talosctl logs &lt;container&gt;</code> or <code>talosctl logs -k &lt;container&gt;</code>.</p>
<h2 id="cleaning-up">Cleaning Up</h2>
<p>To cleanup, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl cluster destroy
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b5d2b35b8cf8ae404c7e6fb7021d5381">4.3 - System Requirements</h1>
    
	<h2 id="minimum-requirements">Minimum Requirements</h2>
<table class="table-auto">
  <thead>
    <tr>
      <th class="px-4 py-2">Role</th>
      <th class="px-4 py-2">Memory</th>
      <th class="px-4 py-2">Cores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border px-4 py-2">Init/Control Plane</td>
      <td class="border px-4 py-2">2GB</td>
      <td class="border px-4 py-2">2</td>
    </tr>
    <tr class="bg-gray-100">
      <td class="border px-4 py-2">Worker</td>
      <td class="border px-4 py-2">1GB</td>
      <td class="border px-4 py-2">1</td>
    </tr>
  </tbody>
</table>
<h2 id="recommended">Recommended</h2>
<table class="table-auto">
  <thead>
    <tr>
      <th class="px-4 py-2">Role</th>
      <th class="px-4 py-2">Memory</th>
      <th class="px-4 py-2">Cores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="border px-4 py-2">Init/Control Plane</td>
      <td class="border px-4 py-2">4GB</td>
      <td class="border px-4 py-2">4</td>
    </tr>
    <tr class="bg-gray-100">
      <td class="border px-4 py-2">Worker</td>
      <td class="border px-4 py-2">2GB</td>
      <td class="border px-4 py-2">2</td>
    </tr>
  </tbody>
</table>
<p>These requirements are similar to that of kubernetes.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9322b4de95a0e0fb454330803430d220">5 - Learn More</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-a160e75460ac4544535966f30cafa0dc">5.1 - Architecture</h1>
    
	<p>In this section we will discuss the various components of which Talos is comprised.</p>
<h2 id="components">Components</h2>
<table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="apid">apid</a></td>
<td>When interacting with Talos, the gRPC API endpoint you&rsquo;re interact with directly is provided by <code>apid</code>. <code>apid</code> acts as the gateway for all component interactions and forwards the requests to <code>routerd</code>.</td>
</tr>
<tr>
<td><a href="containerd">containerd</a></td>
<td>An industry-standard container runtime with an emphasis on simplicity, robustness and portability. To learn more see the <a href="https://containerd.io">containerd website</a>.</td>
</tr>
<tr>
<td><a href="machined">machined</a></td>
<td>Talos replacement for the traditional Linux init-process. Specially designed to run Kubernetes and does not allow starting arbitrary user services.</td>
</tr>
<tr>
<td><a href="networkd">networkd</a></td>
<td>Handles all of the host level network configuration. Configuration is defined under the <code>networking</code> key</td>
</tr>
<tr>
<td><a href="timed">timed</a></td>
<td>Handles the host time synchronization by acting as a NTP-client.</td>
</tr>
<tr>
<td><a href="kernel">kernel</a></td>
<td>The Linux kernel included with Talos is configured according to the recommendations outlined in the <a href="http://kernsec.org/wiki/index.php/Kernel_Self_Protection_Project">Kernel Self Protection Project</a>.</td>
</tr>
<tr>
<td><a href="routerd">routerd</a></td>
<td>Responsible for routing an incoming API request from <code>apid</code> to the appropriate backend (e.g. <code>osd</code>, <code>machined</code> and <code>timed</code>).</td>
</tr>
<tr>
<td><a href="trustd">trustd</a></td>
<td>To run and operate a Kubernetes cluster a certain level of trust is required. Based on the concept of a &lsquo;Root of Trust&rsquo;, <code>trustd</code> is a simple daemon responsible for establishing trust within the system.</td>
</tr>
<tr>
<td><a href="udevd">udevd</a></td>
<td>Implementation of <code>eudev</code> into <code>machined</code>. <code>eudev</code> is Gentoo&rsquo;s fork of udev, systemd&rsquo;s device file manager for the Linux kernel. It manages device nodes in /dev and handles all user space actions when adding or removing devices. To learn more see the <a href="https://wiki.gentoo.org/wiki/Eudev">Gentoo Wiki</a>.</td>
</tr>
</tbody>
</table>
<h3 id="apid">apid</h3>
<p>When interacting with Talos, the gRPC api endpoint you will interact with directly is <code>apid</code>.
Apid acts as the gateway for all component interactions.
Apid provides a mechanism to route requests to the appropriate destination when running on a control plane node.</p>
<p>We&rsquo;ll use some examples below to illustrate what <code>apid</code> is doing.</p>
<p>When a user wants to interact with a Talos component via <code>talosctl</code>, there are two flags that control the interaction with <code>apid</code>.
The <code>-e | --endpoints</code> flag is used to denote which Talos node ( via <code>apid</code> ) should handle the connection.
Typically this is a public facing server.
The <code>-n | --nodes</code> flag is used to denote which Talos node(s) should respond to the request.
If <code>--nodes</code> is not specified, the first endpoint will be used.</p>
<blockquote>
<p>Note: Typically there will be an <code>endpoint</code> already defined in the Talos config file.
Optionally, <code>nodes</code> can be included here as well.</p>
</blockquote>
<p>For example, if a user wants to interact with <code>machined</code>, a command like <code>talosctl -e cluster.talos.dev memory</code> may be used.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl -e cluster.talos.dev memory
NODE                TOTAL   USED   FREE   SHARED   BUFFERS   CACHE   AVAILABLE
cluster.talos.dev   <span style="color:#0000cf;font-weight:bold">7938</span>    <span style="color:#0000cf;font-weight:bold">1768</span>   <span style="color:#0000cf;font-weight:bold">2390</span>   <span style="color:#0000cf;font-weight:bold">145</span>      <span style="color:#0000cf;font-weight:bold">53</span>        <span style="color:#0000cf;font-weight:bold">3724</span>    <span style="color:#0000cf;font-weight:bold">6571</span>
</code></pre></div><p>In this case, <code>talosctl</code> is interacting with <code>apid</code> running on <code>cluster.talos.dev</code> and forwarding the request to the <code>machined</code> api.</p>
<p>If we wanted to extend our example to retrieve <code>memory</code> from another node in our cluster, we could use the command <code>talosctl -e cluster.talos.dev -n node02 memory</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl -e cluster.talos.dev -n node02 memory
NODE    TOTAL   USED   FREE   SHARED   BUFFERS   CACHE   AVAILABLE
node02  <span style="color:#0000cf;font-weight:bold">7938</span>    <span style="color:#0000cf;font-weight:bold">1768</span>   <span style="color:#0000cf;font-weight:bold">2390</span>   <span style="color:#0000cf;font-weight:bold">145</span>      <span style="color:#0000cf;font-weight:bold">53</span>        <span style="color:#0000cf;font-weight:bold">3724</span>    <span style="color:#0000cf;font-weight:bold">6571</span>
</code></pre></div><p>The <code>apid</code> instance on <code>cluster.talos.dev</code> receives the request and forwards it to <code>apid</code> running on <code>node02</code> which forwards the request to the <code>machined</code> api.</p>
<p>We can further extend our example to retrieve <code>memory</code> for all nodes in our cluster by appending additional <code>-n node</code> flags or using a comma separated list of nodes ( <code>-n node01,node02,node03</code> ):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl -e cluster.talos.dev -n node01 -n node02 -n node03 memory
NODE     TOTAL    USED    FREE     SHARED   BUFFERS   CACHE   AVAILABLE
node01   <span style="color:#0000cf;font-weight:bold">7938</span>     <span style="color:#0000cf;font-weight:bold">871</span>     <span style="color:#0000cf;font-weight:bold">4071</span>     <span style="color:#0000cf;font-weight:bold">137</span>      <span style="color:#0000cf;font-weight:bold">49</span>        <span style="color:#0000cf;font-weight:bold">2945</span>    <span style="color:#0000cf;font-weight:bold">7042</span>
node02   <span style="color:#0000cf;font-weight:bold">257844</span>   <span style="color:#0000cf;font-weight:bold">14408</span>   <span style="color:#0000cf;font-weight:bold">190796</span>   <span style="color:#0000cf;font-weight:bold">18138</span>    <span style="color:#0000cf;font-weight:bold">49</span>        <span style="color:#0000cf;font-weight:bold">52589</span>   <span style="color:#0000cf;font-weight:bold">227492</span>
node03   <span style="color:#0000cf;font-weight:bold">257844</span>   <span style="color:#0000cf;font-weight:bold">1830</span>    <span style="color:#0000cf;font-weight:bold">255186</span>   <span style="color:#0000cf;font-weight:bold">125</span>      <span style="color:#0000cf;font-weight:bold">49</span>        <span style="color:#0000cf;font-weight:bold">777</span>     <span style="color:#0000cf;font-weight:bold">254556</span>
</code></pre></div><p>The <code>apid</code> instance on <code>cluster.talos.dev</code> receives the request and forwards is to <code>node01</code>, <code>node02</code>, and <code>node03</code> which then forwards the request to their local <code>machined</code> api.</p>
<h3 id="containerd">containerd</h3>
<p><a href="https://github.com/containerd/containerd">Containerd</a> provides the container runtime to launch workloads on Talos as well as Kubernetes.</p>
<p>Talos services are namespaced under the <code>system</code> namespace in containerd whereas the Kubernetes services are namespaced under the <code>k8s.io</code> namespace.</p>
<h3 id="machined">machined</h3>
<p>A common theme throughout the design of Talos is minimalism.
We believe strongly in the UNIX philosophy that each program should do one job well.
The <code>init</code> included in Talos is one example of this, and we are calling it &ldquo;<code>machined</code>&rdquo;.</p>
<p>We wanted to create a focused <code>init</code> that had one job - run Kubernetes.
To that extent, <code>machined</code> is relatively static in that it does not allow for arbitrary user defined services.
Only the services necessary to run Kubernetes and manage the node are available.
This includes:</p>
<ul>
<li><a href="containerd">containerd</a></li>
<li><a href="kubeadm">kubeadm</a></li>
<li><a href="https://kubernetes.io/docs/concepts/overview/components/">kubelet</a></li>
<li><a href="networkd">networkd</a></li>
<li><a href="timed">timed</a></li>
<li><a href="trustd">trustd</a></li>
<li><a href="udevd">udevd</a></li>
</ul>
<h3 id="networkd">networkd</h3>
<p>Networkd handles all of the host level network configuration.
Configuration is defined under the <code>networking</code> key.</p>
<p>By default, we attempt to issue a DHCP request for every interface on the server.
This can be overridden by supplying one of the following kernel arguments:</p>
<ul>
<li><code>talos.network.interface.ignore</code> - specify a list of interfaces to skip discovery on</li>
<li><code>ip</code> - <code>ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;:&lt;dns0-ip&gt;:&lt;dns1-ip&gt;:&lt;ntp0-ip&gt;</code> as documented in the <a href="https://www.kernel.org/doc/Documentation/filesystems/nfs/nfsroot.txt">kernel here</a>
<ul>
<li>ex, <code>ip=10.0.0.99:::255.0.0.0:control-1:eth0:off:10.0.0.1</code></li>
</ul>
</li>
</ul>
<h3 id="timed">timed</h3>
<p>Timed handles the host time synchronization.</p>
<h3 id="kernel">kernel</h3>
<p>The Linux kernel included with Talos is configured according to the recommendations outlined in the Kernel Self Protection Project (<a href="http://kernsec.org/wiki/index.php/Kernel_Self_Protection_Project">KSSP</a>).</p>
<h3 id="trustd">trustd</h3>
<p>Security is one of the highest priorities within Talos.
To run a Kubernetes cluster a certain level of trust is required to operate a cluster.
For example, orchestrating the bootstrap of a highly available control plane requires the distribution of sensitive PKI data.</p>
<p>To that end, we created <code>trustd</code>.
Based on the concept of a Root of Trust, <code>trustd</code> is a simple daemon responsible for establishing trust within the system.
Once trust is established, various methods become available to the trustee.
It can, for example, accept a write request from another node to place a file on disk.</p>
<p>Additional methods and capability will be added to the <code>trustd</code> component in support of new functionality in the rest of the Talos environment.</p>
<h3 id="udevd">udevd</h3>
<p>Udevd handles the kernel device notifications and sets up the necessary links in <code>/dev</code>.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9dec7054fa62608c2e3aaaca3e418934">5.2 - FAQs</h1>
    
	<!-- markdownlint-disable MD026 -->
<h2 id="how-is-talos-different-from-other-container-optimized-linux-distros">How is Talos different from other container optimized Linux distros?</h2>
<p>Talos shares a lot of attributes with other distros, but there are some important differences.
Talos integrates tightly with Kubernetes, and is not meant to be a general-purpose operating system.
The most important difference is that Talos is fully controlled by an API via a gRPC interface, instead of an ordinary shell.
We don&rsquo;t ship SSH, and there is no console access.
Removing components such as these has allowed us to dramatically reduce the footprint of Talos, and in turn, improve a number of other areas like security, predictability, reliability, and consistency across platforms.
It&rsquo;s a big change from how operating systems have been managed in the past, but we believe that API-driven OSes are the future.</p>
<h2 id="why-no-shell-or-ssh">Why no shell or SSH?</h2>
<p>Since Talos is fully API-driven, all maintenance and debugging operations should be possible via the OS API.
We would like for Talos users to start thinking about what a &ldquo;machine&rdquo; is in the context of a Kubernetes cluster.
That is, that a Kubernetes <em>cluster</em> can be thought of as one massive machine, and the <em>nodes</em> are merely additional, undifferentiated resources.
We don&rsquo;t want humans to focus on the <em>nodes</em>, but rather on the <em>machine</em> that is the Kubernetes cluster.
Should an issue arise at the node level, <code>talosctl</code> should provide the necessary tooling to assist in the identification, debugging, and remedation of the issue.
However, the API is based on the Principle of Least Privilege, and exposes only a limited set of methods.
We envision Talos being a great place for the application of <a href="https://en.wikipedia.org/wiki/Control_theory">control theory</a> in order to provide a self-healing platform.</p>
<h2 id="why-the-name-talos">Why the name &ldquo;Talos&rdquo;?</h2>
<p>Talos was an automaton created by the Greek God of the forge to protect the island of Crete.
He would patrol the coast and enforce laws throughout the land.
We felt it was a fitting name for a security focused operating system designed to run Kubernetes.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-58c92d862c844977ef9db34132dfe2ca">6 - Local Platforms</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6195af5424c7a2a54e778425699a9021">6.1 - Docker</h1>
    
	<p>In this guide we will create a Kubernetes cluster in Docker, using a containerized version of Talos.</p>
<p>Running Talos in Docker is intended to be used in CI pipelines, and local testing when you need a quick and easy cluster.
Furthermore, if you are running Talos in production, it provides an excellent way for developers to develop against the same version of Talos.</p>
<h2 id="requirements">Requirements</h2>
<p>The follow are requirements for running Talos in Docker:</p>
<ul>
<li>Docker 18.03 or greater</li>
<li>a recent version of <a href="https://github.com/talos-systems/talos/releases"><code>talosctl</code></a></li>
</ul>
<h2 id="create-the-cluster">Create the Cluster</h2>
<p>Creating a local cluster is as simple as:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl cluster create --wait
</code></pre></div><p>Once the above finishes successfully, your talosconfig(<code>~/.talos/config</code>) will be configured to point to the new cluster.</p>
<p>If you are running on MacOS, an additional command is required:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl config --endpoints 127.0.0.1
</code></pre></div><blockquote>
<p>Note: Startup times can take up to a minute before the cluster is available.</p>
</blockquote>
<h2 id="retrieve-and-configure-the-kubeconfig">Retrieve and Configure the <code>kubeconfig</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl kubeconfig .
kubectl --kubeconfig kubeconfig config set-cluster talos-default --server https://127.0.0.1:6443
</code></pre></div><h2 id="using-the-cluster">Using the Cluster</h2>
<p>Once the cluster is available, you can make use of <code>talosctl</code> and <code>kubectl</code> to interact with the cluster.
For example, to view current running containers, run <code>talosctl containers</code> for a list of containers in the <code>system</code> namespace, or <code>talosctl containers -k</code> for the <code>k8s.io</code> namespace.
To view the logs of a container, use <code>talosctl logs &lt;container&gt;</code> or <code>talosctl logs -k &lt;container&gt;</code>.</p>
<h2 id="cleaning-up">Cleaning Up</h2>
<p>To cleanup, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl cluster destroy
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f57082df6a8be07422a5628802d0798d">6.2 - Firecracker</h1>
    
	<p>In this guide we will create a Kubernetes cluster using Firecracker.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Linux</li>
<li>a kernel with
<ul>
<li>KVM enabled (<code>/dev/kvm</code> must exist)</li>
<li><code>CONFIG_NET_SCH_NETEM</code> enabled</li>
<li><code>CONFIG_NET_SCH_INGRESS</code> enabled</li>
</ul>
</li>
<li>at least <code>CAP_SYS_ADMIN</code> and <code>CAP_NET_ADMIN</code> capabilities</li>
<li><a href="https://github.com/firecracker-microvm/firecracker/releases">firecracker</a> (v0.21.0 or higher)</li>
<li><code>bridge</code>, <code>static</code> and <code>firewall</code> CNI plugins from the <a href="https://github.com/containernetworking/cni">standard CNI plugins</a>, and <code>tc-redirect-tap</code> CNI plugin from the <a href="https://github.com/awslabs/tc-redirect-tap">awslabs tc-redirect-tap</a> installed to <code>/opt/cni/bin</code></li>
<li>iptables</li>
<li><code>/etc/cni/conf.d</code> directory should exist</li>
<li><code>/var/run/netns</code> directory should exist</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="how-to-get-firecracker-v0210-or-higher">How to get firecracker (v0.21.0 or higher)</h3>
<p>You can download <code>firecracker</code> binary via
<a href="https://github.com/firecracker-microvm/firecracker/releases">github.com/firecracker-microvm/firecracker/releases</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/firecracker-microvm/firecracker/releases/download/&lt;version&gt;/firecracker-&lt;version&gt;-&lt;arch&gt; -L -o firecracker
</code></pre></div><p>For example version <code>v0.21.1</code> for <code>linux</code> platform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/firecracker-microvm/firecracker/releases/download/v0.21.1/firecracker-v0.21.1-x86_64 -L -o firecracker
sudo cp firecracker /usr/local/bin
sudo chmod +x /usr/local/bin/firecracker
</code></pre></div><h3 id="install-talosctl">Install talosctl</h3>
<p>You can download <code>talosctl</code> and all required binaries via
<a href="https://github.com/talos-systems/talos/releases">github.com/talos-systems/talos/releases</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/talos-systems/talos/releases/download/&lt;version&gt;/talosctl-&lt;platform&gt;-&lt;arch&gt; -L -o talosctl
</code></pre></div><p>For example version <code>v0.6.0</code> for <code>linux</code> platform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/talos-systems/talos/releases/download/v0.6.0/talosctl-linux-amd64 -L -o talosctl
sudo cp talosctl /usr/local/bin
sudo chmod +x /usr/local/bin/talosctl
</code></pre></div><h3 id="install-bridge-firewall-and-static-required-cni-plugins">Install bridge, firewall and static required CNI plugins</h3>
<p>You can download standard CNI required plugins via
<a href="https://github.com/containernetworking/plugins/releases">github.com/containernetworking/plugins/releases</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/containernetworking/plugins/releases/download/&lt;version&gt;/cni-plugins-&lt;platform&gt;-&lt;arch&gt;-&lt;version&gt;tgz -L -o cni-plugins-&lt;platform&gt;-&lt;arch&gt;-&lt;version&gt;.tgz
</code></pre></div><p>For example version <code>v0.8.5</code> for <code>linux</code> platform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/containernetworking/plugins/releases/download/v0.8.5/cni-plugins-linux-amd64-v0.8.5.tgz -L -o cni-plugins-linux-amd64-v0.8.5.tgz
mkdir cni-plugins-linux
tar -xf cni-plugins-linux-amd64-v0.8.5.tgz -C cni-plugins-linux
sudo mkdir -p /opt/cni/bin
sudo cp cni-plugins-linux/<span style="color:#ce5c00;font-weight:bold">{</span>bridge,firewall,static<span style="color:#ce5c00;font-weight:bold">}</span> /opt/cni/bin
</code></pre></div><h3 id="install-tc-redirect-tap-cni-plugin">Install tc-redirect-tap CNI plugin</h3>
<p>You should install CNI plugin from the <code>tc-redirect-tap</code> repository <a href="https://github.com/awslabs/tc-redirect-tap">github.com/awslabs/tc-redirect-tap</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go get -d github.com/awslabs/tc-redirect-tap/cmd/tc-redirect-tap
<span style="color:#204a87">cd</span> <span style="color:#000">$GOPATH</span>/src/github.com/awslabs/tc-redirect-tap
make all
sudo cp tc-redirect-tap /opt/cni/bin
</code></pre></div><blockquote>
<p>Note: if <code>$GOPATH</code> is not set, it defaults to <code>~/go</code>.</p>
</blockquote>
<h2 id="install-talos-kernel-and-initramfs">Install Talos kernel and initramfs</h2>
<p>Firecracker provisioner depends on Talos uncompressed kernel (<code>vmlinuz</code>) and initramfs (<code>initramfs.xz</code>).
These files can be downloaded from the Talos release:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p _out/
curl https://github.com/talos-systems/talos/releases/download/&lt;version&gt;/vmlinuz -L -o _out/vmlinuz
curl https://github.com/talos-systems/talos/releases/download/&lt;version&gt;/initramfs.xz -L -o _out/initramfs.xz
</code></pre></div><p>For example version <code>v0.6.0</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/talos-systems/talos/releases/download/v0.6.0/vmlinuz -L -o _out/vmlinuz
curl https://github.com/talos-systems/talos/releases/download/v0.6.0/initramfs.xz -L -o _out/initramfs.xz
</code></pre></div><h2 id="create-the-cluster">Create the Cluster</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo talosctl cluster create --provisioner firecracker
</code></pre></div><p>Once the above finishes successfully, your talosconfig(<code>~/.talos/config</code>) will be configured to point to the new cluster.</p>
<h2 id="retrieve-and-configure-the-kubeconfig">Retrieve and Configure the <code>kubeconfig</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl kubeconfig .
</code></pre></div><h2 id="using-the-cluster">Using the Cluster</h2>
<p>Once the cluster is available, you can make use of <code>talosctl</code> and <code>kubectl</code> to interact with the cluster.
For example, to view current running containers, run <code>talosctl containers</code> for a list of containers in the <code>system</code> namespace, or <code>talosctl containers -k</code> for the <code>k8s.io</code> namespace.
To view the logs of a container, use <code>talosctl logs &lt;container&gt;</code> or <code>talosctl logs -k &lt;container&gt;</code>.</p>
<p>A bridge interface will be created, and assigned the default IP 10.5.0.1.
Each node will be directly accessible on the subnet specified at cluster creation time.
A loadbalancer runs on 10.5.0.1 by default, which handles loadbalancing for the Talos, and Kubernetes APIs.</p>
<p>You can see a summary of the cluster state by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl cluster show --provisioner firecracker
PROVISIONER       firecracker
NAME              talos-default
NETWORK NAME      talos-default
NETWORK CIDR      10.5.0.0/24
NETWORK GATEWAY   10.5.0.1
NETWORK MTU       <span style="color:#0000cf;font-weight:bold">1500</span>

NODES:

NAME                     TYPE           IP         CPU    RAM      DISK
talos-default-master-1   Init           10.5.0.2   1.00   1.6 GB   4.3 GB
talos-default-master-2   ControlPlane   10.5.0.3   1.00   1.6 GB   4.3 GB
talos-default-master-3   ControlPlane   10.5.0.4   1.00   1.6 GB   4.3 GB
talos-default-worker-1   Join           10.5.0.5   1.00   1.6 GB   4.3 GB
</code></pre></div><h2 id="cleaning-up">Cleaning Up</h2>
<p>To cleanup, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo talosctl cluster destroy --provisioner firecracker
</code></pre></div><blockquote>
<p>Note: In that case that the host machine is rebooted before destroying the cluster, you may need to manually remove <code>~/.talos/clusters/talos-default</code>.</p>
</blockquote>
<h2 id="manual-clean-up">Manual Clean Up</h2>
<p>The <code>talosctl cluster destroy</code> command depends heavily on the clusters state directory.
It contains all related information of the cluster.
The PIDs and network associated with the cluster nodes.</p>
<p>If you happened to have deleted the state folder by mistake or you would like to cleanup
the environment, here are the steps how to do it manually:</p>
<h3 id="stopping-vms">Stopping VMs</h3>
<p>Find the process of <code>firecracker --api-sock</code> execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[f]irecracker --api-sock&#39;</span>
</code></pre></div><p>To stop the VMs manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where VMs are running with PIDs <strong>158065</strong> and <strong>158216</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[f]irecracker --api-sock&#39;</span>
<span style="color:#0000cf;font-weight:bold">4</span> S root      <span style="color:#0000cf;font-weight:bold">158065</span>  <span style="color:#0000cf;font-weight:bold">157615</span> <span style="color:#0000cf;font-weight:bold">44</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">264152</span> -     07:54 ?        00:34:25 firecracker --api-sock /root/.talos/clusters/k8s/k8s-master-1.sock
<span style="color:#0000cf;font-weight:bold">4</span> S root      <span style="color:#0000cf;font-weight:bold">158216</span>  <span style="color:#0000cf;font-weight:bold">157617</span> <span style="color:#0000cf;font-weight:bold">18</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">264152</span> -     07:55 ?        00:14:47 firecracker --api-sock /root/.talos/clusters/k8s/k8s-worker-1.sock
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">158065</span>
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">158216</span>
</code></pre></div><h3 id="remove-vms">Remove VMs</h3>
<p>Find the process of <code>talosctl firecracker-launch</code> execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;talosctl firecracker-launch&#39;</span>
</code></pre></div><p>To remove the VMs manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where VMs are running with PIDs <strong>157615</strong> and <strong>157617</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[t]alosctl firecracker-launch&#39;</span>
<span style="color:#0000cf;font-weight:bold">0</span> S root      <span style="color:#0000cf;font-weight:bold">157615</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">184934</span> -     07:53 ?        00:00:00 talosctl firecracker-launch
<span style="color:#0000cf;font-weight:bold">0</span> S root      <span style="color:#0000cf;font-weight:bold">157617</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">185062</span> -     07:53 ?        00:00:00 talosctl firecracker-launch
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157615</span>
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157617</span>
</code></pre></div><h3 id="remove-load-balancer">Remove load balancer</h3>
<p>Find the process of <code>talosctl loadbalancer-launch</code> execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;talosctl loadbalancer-launch&#39;</span>
</code></pre></div><p>To remove the LB manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where loadbalancer is running with PID <strong>157609</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[t]alosctl loadbalancer-launch&#39;</span>
<span style="color:#0000cf;font-weight:bold">4</span> S root      <span style="color:#0000cf;font-weight:bold">157609</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">184998</span> -     07:53 ?        00:00:07 talosctl loadbalancer-launch --loadbalancer-addr 10.5.0.1 --loadbalancer-upstreams 10.5.0.2
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157609</span>
</code></pre></div><h3 id="remove-network">Remove network</h3>
<p>This is more tricky part as if you have already deleted the state folder.
If you didn&rsquo;t then it is written in the <code>state.yaml</code> in the
<code>/root/.talos/clusters/&lt;cluster-name&gt;</code> directory.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo cat /root/.talos/clusters/&lt;cluster-name&gt;/state.yaml <span style="color:#000;font-weight:bold">|</span> grep bridgename
bridgename: talos&lt;uuid&gt;
</code></pre></div><p>If you only had one cluster, then it will be the interface with name
<code>talos&lt;uuid&gt;</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">46: talos&lt;uuid&gt;: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style="color:#0000cf;font-weight:bold">1500</span> qdisc noqueue state DOWN group default qlen <span style="color:#0000cf;font-weight:bold">1000</span>
    link/ether a6:72:f4:0a:d3:9c brd ff:ff:ff:ff:ff:ff
    inet 10.5.0.1/24 brd 10.5.0.255 scope global talos17c13299
       valid_lft forever preferred_lft forever
    inet6 fe80::a472:f4ff:fe0a:d39c/64 scope link
       valid_lft forever preferred_lft forever
</code></pre></div><p>To remove this interface:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo ip link del talos&lt;uuid&gt;
</code></pre></div><h3 id="remove-state-directory">Remove state directory</h3>
<p>To remove the state directory execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo rm -Rf /root/.talos/clusters/&lt;cluster-name&gt;
</code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="logs">Logs</h3>
<p>Inspect logs directory</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo cat /root/.talos/clusters/&lt;cluster-name&gt;/*.log
</code></pre></div><p>Logs are saved under <code>&lt;cluster-name&gt;-&lt;role&gt;-&lt;node-id&gt;.log</code></p>
<p>For example in case of <strong>k8s</strong> cluster name:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo ls -la /root/.talos/clusters/k8s <span style="color:#000;font-weight:bold">|</span> grep log
-rw-r--r--. <span style="color:#0000cf;font-weight:bold">1</span> root root      <span style="color:#0000cf;font-weight:bold">69415</span> Apr <span style="color:#0000cf;font-weight:bold">26</span> 20:58 k8s-master-1.log
-rw-r--r--. <span style="color:#0000cf;font-weight:bold">1</span> root root      <span style="color:#0000cf;font-weight:bold">68345</span> Apr <span style="color:#0000cf;font-weight:bold">26</span> 20:58 k8s-worker-1.log
-rw-r--r--. <span style="color:#0000cf;font-weight:bold">1</span> root root      <span style="color:#0000cf;font-weight:bold">24621</span> Apr <span style="color:#0000cf;font-weight:bold">26</span> 20:59 lb.log
</code></pre></div><p>Inspect logs during the installation</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo su -
tail -f /root/.talos/clusters/&lt;cluster-name&gt;/*.log
</code></pre></div><h2 id="post-installation">Post-installation</h2>
<p>After executing these steps and you should be able to use <code>kubectl</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo talosctl kubeconfig .
mv kubeconfig <span style="color:#000">$HOME</span>/.kube/config
sudo chown <span style="color:#000">$USER</span>:<span style="color:#000">$USER</span> <span style="color:#000">$HOME</span>/.kube/config
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8ed0ebdc1cb4547d368d9fcf0f14c45b">6.3 - QEMU</h1>
    
	<p>In this guide we will create a Kubernetes cluster using QEMU.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Linux</li>
<li>a kernel with
<ul>
<li>KVM enabled (<code>/dev/kvm</code> must exist)</li>
<li><code>CONFIG_NET_SCH_NETEM</code> enabled</li>
<li><code>CONFIG_NET_SCH_INGRESS</code> enabled</li>
</ul>
</li>
<li>at least <code>CAP_SYS_ADMIN</code> and <code>CAP_NET_ADMIN</code> capabilities</li>
<li>QEMU</li>
<li><code>bridge</code>, <code>static</code> and <code>firewall</code> CNI plugins from the <a href="https://github.com/containernetworking/cni">standard CNI plugins</a>, and <code>tc-redirect-tap</code> CNI plugin from the <a href="https://github.com/awslabs/tc-redirect-tap">awslabs tc-redirect-tap</a> installed to <code>/opt/cni/bin</code></li>
<li>iptables</li>
<li><code>/etc/cni/conf.d</code> directory should exist</li>
<li><code>/var/run/netns</code> directory should exist</li>
</ul>
<h2 id="installation">Installation</h2>
<h3 id="how-to-get-qemu">How to get QEMU</h3>
<p>Install QEMU with your operating system package manager.
For example, on Ubuntu for x86:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">apt install qemu-system-x86 qemu-kvm
</code></pre></div><h3 id="install-talosctl">Install talosctl</h3>
<p>You can download <code>talosctl</code> and all required binaries via
<a href="https://github.com/talos-systems/talos/releases">github.com/talos-systems/talos/releases</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/talos-systems/talos/releases/download/&lt;version&gt;/talosctl-&lt;platform&gt;-&lt;arch&gt; -L -o talosctl
</code></pre></div><p>For example version <code>v0.6.0</code> for <code>linux</code> platform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/talos-systems/talos/releases/download/v0.6.0/talosctl-linux-amd64 -L -o talosctl
sudo cp talosctl /usr/local/bin
sudo chmod +x /usr/local/bin/talosctl
</code></pre></div><h3 id="install-bridge-firewall-and-static-required-cni-plugins">Install bridge, firewall and static required CNI plugins</h3>
<p>You can download standard CNI required plugins via
<a href="https://github.com/containernetworking/plugins/releases">github.com/containernetworking/plugins/releases</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/containernetworking/plugins/releases/download/&lt;version&gt;/cni-plugins-&lt;platform&gt;-&lt;arch&gt;-&lt;version&gt;tgz -L -o cni-plugins-&lt;platform&gt;-&lt;arch&gt;-&lt;version&gt;.tgz
</code></pre></div><p>For example version <code>v0.8.5</code> for <code>linux</code> platform:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/containernetworking/plugins/releases/download/v0.8.5/cni-plugins-linux-amd64-v0.8.5.tgz -L -o cni-plugins-linux-amd64-v0.8.5.tgz
mkdir cni-plugins-linux
tar -xf cni-plugins-linux-amd64-v0.8.5.tgz -C cni-plugins-linux
sudo mkdir -p /opt/cni/bin
sudo cp cni-plugins-linux/<span style="color:#ce5c00;font-weight:bold">{</span>bridge,firewall,static<span style="color:#ce5c00;font-weight:bold">}</span> /opt/cni/bin
</code></pre></div><h3 id="install-tc-redirect-tap-cni-plugin">Install tc-redirect-tap CNI plugin</h3>
<p>You should install CNI plugin from the <code>tc-redirect-tap</code> repository <a href="https://github.com/awslabs/tc-redirect-tap">github.com/awslabs/tc-redirect-tap</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">go get -d github.com/awslabs/tc-redirect-tap/cmd/tc-redirect-tap
<span style="color:#204a87">cd</span> <span style="color:#000">$GOPATH</span>/src/github.com/awslabs/tc-redirect-tap
make all
sudo cp tc-redirect-tap /opt/cni/bin
</code></pre></div><blockquote>
<p>Note: if <code>$GOPATH</code> is not set, it defaults to <code>~/go</code>.</p>
</blockquote>
<h2 id="install-talos-kernel-and-initramfs">Install Talos kernel and initramfs</h2>
<p>QEMU provisioner depends on Talos kernel (<code>vmlinuz</code>) and initramfs (<code>initramfs.xz</code>).
These files can be downloaded from the Talos release:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p _out/
curl https://github.com/talos-systems/talos/releases/download/&lt;version&gt;/vmlinuz -L -o _out/vmlinuz
curl https://github.com/talos-systems/talos/releases/download/&lt;version&gt;/initramfs.xz -L -o _out/initramfs.xz
</code></pre></div><p>For example version <code>v0.6.0</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl https://github.com/talos-systems/talos/releases/download/v0.6.0/vmlinuz -L -o _out/vmlinuz
curl https://github.com/talos-systems/talos/releases/download/v0.6.0/initramfs.xz -L -o _out/initramfs.xz
</code></pre></div><h2 id="create-the-cluster">Create the Cluster</h2>
<p>For the first time, create root state directory as your user so that you can inspect the logs as non-root user:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir -p ~/.talos/clusters
</code></pre></div><p>Create the cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo -E talosctl cluster create --provisioner qemu
</code></pre></div><p>Once the above finishes successfully, your talosconfig(<code>~/.talos/config</code>) will be configured to point to the new cluster.</p>
<h2 id="retrieve-and-configure-the-kubeconfig">Retrieve and Configure the <code>kubeconfig</code></h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl -n 10.5.0.2 kubeconfig .
</code></pre></div><h2 id="using-the-cluster">Using the Cluster</h2>
<p>Once the cluster is available, you can make use of <code>talosctl</code> and <code>kubectl</code> to interact with the cluster.
For example, to view current running containers, run <code>talosctl containers</code> for a list of containers in the <code>system</code> namespace, or <code>talosctl containers -k</code> for the <code>k8s.io</code> namespace.
To view the logs of a container, use <code>talosctl logs &lt;container&gt;</code> or <code>talosctl logs -k &lt;container&gt;</code>.</p>
<p>A bridge interface will be created, and assigned the default IP 10.5.0.1.
Each node will be directly accessible on the subnet specified at cluster creation time.
A loadbalancer runs on 10.5.0.1 by default, which handles loadbalancing for the Talos, and Kubernetes APIs.</p>
<p>You can see a summary of the cluster state by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl cluster show --provisioner qemu
PROVISIONER       qemu
NAME              talos-default
NETWORK NAME      talos-default
NETWORK CIDR      10.5.0.0/24
NETWORK GATEWAY   10.5.0.1
NETWORK MTU       <span style="color:#0000cf;font-weight:bold">1500</span>

NODES:

NAME                     TYPE           IP         CPU    RAM      DISK
talos-default-master-1   Init           10.5.0.2   1.00   1.6 GB   4.3 GB
talos-default-master-2   ControlPlane   10.5.0.3   1.00   1.6 GB   4.3 GB
talos-default-master-3   ControlPlane   10.5.0.4   1.00   1.6 GB   4.3 GB
talos-default-worker-1   Join           10.5.0.5   1.00   1.6 GB   4.3 GB
</code></pre></div><h2 id="cleaning-up">Cleaning Up</h2>
<p>To cleanup, run:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo -E talosctl cluster destroy --provisioner qemu
</code></pre></div><blockquote>
<p>Note: In that case that the host machine is rebooted before destroying the cluster, you may need to manually remove <code>~/.talos/clusters/talos-default</code>.</p>
</blockquote>
<h2 id="manual-clean-up">Manual Clean Up</h2>
<p>The <code>talosctl cluster destroy</code> command depends heavily on the clusters state directory.
It contains all related information of the cluster.
The PIDs and network associated with the cluster nodes.</p>
<p>If you happened to have deleted the state folder by mistake or you would like to cleanup
the environment, here are the steps how to do it manually:</p>
<h3 id="remove-vm-launchers">Remove VM Launchers</h3>
<p>Find the process of <code>talosctl qemu-launch</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;talosctl qemu-launch&#39;</span>
</code></pre></div><p>To remove the VMs manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where VMs are running with PIDs <strong>157615</strong> and <strong>157617</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[t]alosctl qemu-launch&#39;</span>
<span style="color:#0000cf;font-weight:bold">0</span> S root      <span style="color:#0000cf;font-weight:bold">157615</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">184934</span> -     07:53 ?        00:00:00 talosctl qemu-launch
<span style="color:#0000cf;font-weight:bold">0</span> S root      <span style="color:#0000cf;font-weight:bold">157617</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">185062</span> -     07:53 ?        00:00:00 talosctl qemu-launch
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157615</span>
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157617</span>
</code></pre></div><h3 id="stopping-vms">Stopping VMs</h3>
<p>Find the process of <code>qemu-system</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;qemu-system&#39;</span>
</code></pre></div><p>To stop the VMs manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where VMs are running with PIDs <strong>158065</strong> and <strong>158216</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep qemu-system
<span style="color:#0000cf;font-weight:bold">2</span> S root     <span style="color:#0000cf;font-weight:bold">1061663</span> <span style="color:#0000cf;font-weight:bold">1061168</span> <span style="color:#0000cf;font-weight:bold">26</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">1786238</span> -    14:05 ?        01:53:56 qemu-system-x86_64 -m <span style="color:#0000cf;font-weight:bold">2048</span> -drive <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span>raw,if<span style="color:#ce5c00;font-weight:bold">=</span>virtio,file<span style="color:#ce5c00;font-weight:bold">=</span>/home/username/.talos/clusters/talos-default/bootstrap-master.disk -smp <span style="color:#000">cpus</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span> -cpu max -nographic -netdev tap,id<span style="color:#ce5c00;font-weight:bold">=</span>net0,ifname<span style="color:#ce5c00;font-weight:bold">=</span>tap0,script<span style="color:#ce5c00;font-weight:bold">=</span>no,downscript<span style="color:#ce5c00;font-weight:bold">=</span>no -device virtio-net-pci,netdev<span style="color:#ce5c00;font-weight:bold">=</span>net0,mac<span style="color:#ce5c00;font-weight:bold">=</span>1e:86:c6:b4:7c:c4 -device virtio-rng-pci -no-reboot -boot <span style="color:#000">order</span><span style="color:#ce5c00;font-weight:bold">=</span>cn,reboot-timeout<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5000</span> -smbios <span style="color:#000">type</span><span style="color:#ce5c00;font-weight:bold">=</span>1,uuid<span style="color:#ce5c00;font-weight:bold">=</span>7ec0a73c-826e-4eeb-afd1-39ff9f9160ca -machine q35,accel<span style="color:#ce5c00;font-weight:bold">=</span>kvm
<span style="color:#0000cf;font-weight:bold">2</span> S root     <span style="color:#0000cf;font-weight:bold">1061663</span> <span style="color:#0000cf;font-weight:bold">1061170</span> <span style="color:#0000cf;font-weight:bold">67</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">621014</span> -     21:23 ?        00:00:07 qemu-system-x86_64 -m <span style="color:#0000cf;font-weight:bold">2048</span> -drive <span style="color:#000">format</span><span style="color:#ce5c00;font-weight:bold">=</span>raw,if<span style="color:#ce5c00;font-weight:bold">=</span>virtio,file<span style="color:#ce5c00;font-weight:bold">=</span>/homeusername/.talos/clusters/talos-default/pxe-1.disk -smp <span style="color:#000">cpus</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span> -cpu max -nographic -netdev tap,id<span style="color:#ce5c00;font-weight:bold">=</span>net0,ifname<span style="color:#ce5c00;font-weight:bold">=</span>tap0,script<span style="color:#ce5c00;font-weight:bold">=</span>no,downscript<span style="color:#ce5c00;font-weight:bold">=</span>no -device virtio-net-pci,netdev<span style="color:#ce5c00;font-weight:bold">=</span>net0,mac<span style="color:#ce5c00;font-weight:bold">=</span>36:f3:2f:c3:9f:06 -device virtio-rng-pci -no-reboot -boot <span style="color:#000">order</span><span style="color:#ce5c00;font-weight:bold">=</span>cn,reboot-timeout<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">5000</span> -smbios <span style="color:#000">type</span><span style="color:#ce5c00;font-weight:bold">=</span>1,uuid<span style="color:#ce5c00;font-weight:bold">=</span>ce12a0d0-29c8-490f-b935-f6073ab916a6 -machine q35,accel<span style="color:#ce5c00;font-weight:bold">=</span>kvm
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">1061663</span>
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">1061663</span>
</code></pre></div><h3 id="remove-load-balancer">Remove load balancer</h3>
<p>Find the process of <code>talosctl loadbalancer-launch</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;talosctl loadbalancer-launch&#39;</span>
</code></pre></div><p>To remove the LB manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where loadbalancer is running with PID <strong>157609</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[t]alosctl loadbalancer-launch&#39;</span>
<span style="color:#0000cf;font-weight:bold">4</span> S root      <span style="color:#0000cf;font-weight:bold">157609</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">184998</span> -     07:53 ?        00:00:07 talosctl loadbalancer-launch --loadbalancer-addr 10.5.0.1 --loadbalancer-upstreams 10.5.0.2
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157609</span>
</code></pre></div><h3 id="remove-dhcp-server">Remove DHCP server</h3>
<p>Find the process of <code>talosctl dhcpd-launch</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;talosctl dhcpd-launch&#39;</span>
</code></pre></div><p>To remove the LB manually, execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo <span style="color:#204a87">kill</span> -s SIGTERM &lt;PID&gt;
</code></pre></div><p>Example output, where loadbalancer is running with PID <strong>157609</strong></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -elf <span style="color:#000;font-weight:bold">|</span> grep <span style="color:#4e9a06">&#39;[t]alosctl dhcpd-launch&#39;</span>
<span style="color:#0000cf;font-weight:bold">4</span> S root      <span style="color:#0000cf;font-weight:bold">157609</span>    <span style="color:#0000cf;font-weight:bold">2835</span>  <span style="color:#0000cf;font-weight:bold">0</span>  <span style="color:#0000cf;font-weight:bold">80</span>   <span style="color:#0000cf;font-weight:bold">0</span> - <span style="color:#0000cf;font-weight:bold">184998</span> -     07:53 ?        00:00:07 talosctl dhcpd-launch --state-path /home/username/.talos/clusters/talos-default --addr 10.5.0.1 --interface talosbd9c32bc
sudo <span style="color:#204a87">kill</span> -s SIGTERM <span style="color:#0000cf;font-weight:bold">157609</span>
</code></pre></div><h3 id="remove-network">Remove network</h3>
<p>This is more tricky part as if you have already deleted the state folder.
If you didn&rsquo;t then it is written in the <code>state.yaml</code> in the
<code>~/.talos/clusters/&lt;cluster-name&gt;</code> directory.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo cat ~/.talos/clusters/&lt;cluster-name&gt;/state.yaml <span style="color:#000;font-weight:bold">|</span> grep bridgename
bridgename: talos&lt;uuid&gt;
</code></pre></div><p>If you only had one cluster, then it will be the interface with name
<code>talos&lt;uuid&gt;</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">46: talos&lt;uuid&gt;: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu <span style="color:#0000cf;font-weight:bold">1500</span> qdisc noqueue state DOWN group default qlen <span style="color:#0000cf;font-weight:bold">1000</span>
    link/ether a6:72:f4:0a:d3:9c brd ff:ff:ff:ff:ff:ff
    inet 10.5.0.1/24 brd 10.5.0.255 scope global talos17c13299
       valid_lft forever preferred_lft forever
    inet6 fe80::a472:f4ff:fe0a:d39c/64 scope link
       valid_lft forever preferred_lft forever
</code></pre></div><p>To remove this interface:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo ip link del talos&lt;uuid&gt;
</code></pre></div><h3 id="remove-state-directory">Remove state directory</h3>
<p>To remove the state directory execute:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo rm -Rf /home/<span style="color:#000">$USER</span>/.talos/clusters/&lt;cluster-name&gt;
</code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="logs">Logs</h3>
<p>Inspect logs directory</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo cat ~/.talos/clusters/&lt;cluster-name&gt;/*.log
</code></pre></div><p>Logs are saved under <code>&lt;cluster-name&gt;-&lt;role&gt;-&lt;node-id&gt;.log</code></p>
<p>For example in case of <strong>k8s</strong> cluster name:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ls -la ~/.talos/clusters/k8s <span style="color:#000;font-weight:bold">|</span> grep log
-rw-r--r--. <span style="color:#0000cf;font-weight:bold">1</span> root root      <span style="color:#0000cf;font-weight:bold">69415</span> Apr <span style="color:#0000cf;font-weight:bold">26</span> 20:58 k8s-master-1.log
-rw-r--r--. <span style="color:#0000cf;font-weight:bold">1</span> root root      <span style="color:#0000cf;font-weight:bold">68345</span> Apr <span style="color:#0000cf;font-weight:bold">26</span> 20:58 k8s-worker-1.log
-rw-r--r--. <span style="color:#0000cf;font-weight:bold">1</span> root root      <span style="color:#0000cf;font-weight:bold">24621</span> Apr <span style="color:#0000cf;font-weight:bold">26</span> 20:59 lb.log
</code></pre></div><p>Inspect logs during the installation</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tail -f ~/.talos/clusters/&lt;cluster-name&gt;/*.log
</code></pre></div>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b00a88a07ceb21b1a83e5822e0c86c1d">7 - Reference</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-e258fa43c114d11d63abd25106fafe87">7.1 - Configuration</h1>
    
	<!-- markdownlint-disable MD024 -->
<p>Package v1alpha1 configuration file contains all the options available for configuring a machine.</p>
<p>We can generate the files using <code>talosctl</code>.
This configuration is enough to get started in most cases, however it can be customized as needed.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl config generate --version v1alpha1 &lt;cluster name&gt; &lt;cluster endpoint&gt;
</code></pre></div><p>This will generate a machine config for each node type, and a talosconfig.
The following is an example of an <code>init.yaml</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">version</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">v1alpha1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">machine</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">init</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">5dt69c.npg6duv71zwqhzbg</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;base64 encoded Ed25519 certificate&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;base64 encoded Ed25519 key&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">certSANs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">[]</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">kubelet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">install</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">disk</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/dev/sda</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">docker.io/autonomy/installer:latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">bootloader</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">wipe</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">force</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">controlPlane</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://1.2.3.4</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">clusterName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">example</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">cni</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">dnsDomain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cluster.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">podSubnets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#0000cf;font-weight:bold">10.244.0.0</span><span style="color:#000">/16</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">serviceSubnets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#0000cf;font-weight:bold">10.96.0.0</span><span style="color:#000">/12</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">wlzjyw.bei2zfylhs2by0wd</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">certificateKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">20d9aafb46d6db4c0958db5b3fc481c8c14fc9b1abd8ac43194f4246b77131be</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">aescbcEncryptionSecret</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">z01mye6j16bspJYtTB/5SFX8j7Ph4JXxM2Xuu4vsBPM=</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;base64 encoded RSA certificate&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;base64 encoded RSA key&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">apiServer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">controllerManager</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">scheduler</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>{}<span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">etcd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;base64 encoded RSA certificate&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">&lt;base64 encoded RSA key&gt;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h3 id="config">Config</h3>
<h4 id="version">version</h4>
<p>Indicates the schema used to decode the contents.</p>
<p>Type: <code>string</code></p>
<p>Valid Values:</p>
<ul>
<li><code>v1alpha1</code></li>
</ul>
<h4 id="debug">debug</h4>
<p>Enable verbose logging.</p>
<p>Type: <code>bool</code></p>
<p>Valid Values:</p>
<ul>
<li><code>true</code></li>
<li><code>yes</code></li>
<li><code>false</code></li>
<li><code>no</code></li>
</ul>
<h4 id="persist">persist</h4>
<p>Indicates whether to pull the machine config upon every boot.</p>
<p>Type: <code>bool</code></p>
<p>Valid Values:</p>
<ul>
<li><code>true</code></li>
<li><code>yes</code></li>
<li><code>false</code></li>
<li><code>no</code></li>
</ul>
<h4 id="machine">machine</h4>
<p>Provides machine specific configuration options.</p>
<p>Type: <code>MachineConfig</code></p>
<h4 id="cluster">cluster</h4>
<p>Provides cluster specific configuration options.</p>
<p>Type: <code>ClusterConfig</code></p>
<hr>
<h3 id="machineconfig">MachineConfig</h3>
<h4 id="type">type</h4>
<p>Defines the role of the machine within the cluster.</p>
<h5 id="init">Init</h5>
<p>Init node type designates the first control plane node to come up.
You can think of it like a bootstrap node.
This node will perform the initial steps to bootstrap the cluster &ndash; generation of TLS assets, starting of the control plane, etc.</p>
<h5 id="control-plane">Control Plane</h5>
<p>Control Plane node type designates the node as a control plane member.
This means it will host etcd along with the Kubernetes master components such as API Server, Controller Manager, Scheduler.</p>
<h5 id="worker">Worker</h5>
<p>Worker node type designates the node as a worker node.
This means it will be an available compute node for scheduling workloads.</p>
<p>Type: <code>string</code></p>
<p>Valid Values:</p>
<ul>
<li><code>init</code></li>
<li><code>controlplane</code></li>
<li><code>join</code></li>
</ul>
<h4 id="token">token</h4>
<p>The <code>token</code> is used by a machine to join the PKI of the cluster.
Using this token, a machine will create a certificate signing request (CSR), and request a certificate that will be used as its' identity.</p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">328hom.uqjzh6jnn2eie9oi</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><blockquote>
<p>Warning: It is important to ensure that this token is correct since a machine&rsquo;s certificate has a short TTL by default</p>
</blockquote>
<h4 id="ca">ca</h4>
<p>The root certificate authority of the PKI.
It is composed of a base64 encoded <code>crt</code> and <code>key</code>.</p>
<p>Type: <code>PEMEncodedCertificateAndKey</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJIekNCMHF...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0KTUM...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="certsans">certSANs</h4>
<p>Extra certificate subject alternative names for the machine&rsquo;s certificate.
By default, all non-loopback interface IPs are automatically added to the certificate&rsquo;s SANs.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">certSANs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#0000cf;font-weight:bold">10.0.0.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#0000cf;font-weight:bold">172.16.0.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#0000cf;font-weight:bold">192.168.0.10</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="kubelet">kubelet</h4>
<p>Used to provide additional options to the kubelet.</p>
<p>Type: <code>KubeletConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">kubelet</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="network">network</h4>
<p>Used to configure the machine&rsquo;s network.</p>
<p>Type: <code>NetworkConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">hostname</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">worker-1</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">interfaces</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">nameservers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#0000cf;font-weight:bold">9.8.7.6</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#0000cf;font-weight:bold">8.7.6.5</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="disks">disks</h4>
<p>Used to partition, format and mount additional disks.
Since the rootfs is read only with the exception of <code>/var</code>, mounts are only valid if they are under <code>/var</code>.
Note that the partitioning and formating is done only once, if and only if no existing partitions are found.
If <code>size:</code> is omitted, the partition is sized to occupy full disk.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">disks</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">device</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/dev/sdb</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">partitions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#204a87;font-weight:bold">mountpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/lib/extra</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">size</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">10000000000</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><blockquote>
<p>Note: <code>size</code> is in units of bytes.</p>
</blockquote>
<h4 id="install">install</h4>
<p>Used to provide instructions for bare-metal installations.</p>
<p>Type: <code>InstallConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">install</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">disk</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/dev/sda</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extraKernelArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">option=value</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">docker.io/autonomy/installer:latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">bootloader</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">wipe</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">force</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">false</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="files">files</h4>
<p>Allows the addition of user specified files.
The value of <code>op</code> can be <code>create</code>, <code>overwrite</code>, or <code>append</code>.
In the case of <code>create</code>, <code>path</code> must not exist.
In the case of <code>overwrite</code>, and <code>append</code>, <code>path</code> must be a valid file.
If an <code>op</code> value of <code>append</code> is used, the existing file will be appended.
Note that the file contents are not required to be base64 encoded.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">files</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">content</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic">      </span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">permissions</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">0666</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">path</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/tmp/file.txt</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">op</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">append</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><blockquote>
<p>Note: The specified <code>path</code> is relative to <code>/var</code>.</p>
</blockquote>
<h4 id="env">env</h4>
<p>The <code>env</code> field allows for the addition of environment variables to a machine.
All environment variables are set on the machine in addition to every service.</p>
<p>Type: <code>Env</code></p>
<p>Valid Values:</p>
<ul>
<li><code>GRPC_GO_LOG_VERBOSITY_LEVEL</code></li>
<li><code>GRPC_GO_LOG_SEVERITY_LEVEL</code></li>
<li><code>http_proxy</code></li>
<li><code>https_proxy</code></li>
<li><code>no_proxy</code></li>
</ul>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">GRPC_GO_LOG_VERBOSITY_LEVEL</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;99&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">GRPC_GO_LOG_SEVERITY_LEVEL</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">info</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">https_proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http://SERVER:PORT/</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">GRPC_GO_LOG_SEVERITY_LEVEL</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">error</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">https_proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://USERNAME:PASSWORD@SERVER:PORT/</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">env</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">https_proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http://DOMAIN\\USERNAME:PASSWORD@SERVER:PORT/</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="time">time</h4>
<p>Used to configure the machine&rsquo;s time settings.</p>
<p>Type: <code>TimeConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">time</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">time.cloudflare.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="sysctls">sysctls</h4>
<p>Used to configure the machine&rsquo;s sysctls.</p>
<p>Type: <code>map</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">sysctls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">kernel.domainname</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">talos.dev</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">net.ipv4.ip_forward</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;0&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="registries">registries</h4>
<p>Used to configure the machine&rsquo;s container image registry mirrors.</p>
<p>Automatically generates matching CRI configuration for registry mirrors.</p>
<p>Section <code>mirrors</code> allows to redirect requests for images to non-default registry,
which might be local registry or caching mirror.</p>
<p>Section <code>config</code> provides a way to authenticate to the registry with TLS client
identity, provide registry CA, or authentication information.
Authentication information has same meaning with the corresponding field in <code>.docker/config.json</code>.</p>
<p>See also matching configuration for <a href="https://github.com/containerd/cri/blob/master/docs/registry.md">CRI containerd plugin</a>.</p>
<p>Type: <code>RegistriesConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">registries</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">mirrors</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">docker.io</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">endpoints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">https://registry-1.docker.io</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">&#39;*&#39;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">endpoints</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span>- <span style="color:#000">http://some.host:123/</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">config</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#4e9a06">&#34;some.host:123&#34;</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">CA</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># base64-encoded CA certificate in PEM format</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">clientIdentity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">cert</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">... </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># base64-encoded client certificate in PEM format</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">        </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">... </span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#8f5902;font-style:italic"># base64-encoded client key in PEM format</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">auth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">username</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">password</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">auth</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">identityToken</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><hr>
<h3 id="clusterconfig">ClusterConfig</h3>
<h4 id="controlplane">controlPlane</h4>
<p>Provides control plane specific configuration options.</p>
<p>Type: <code>ControlPlaneConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">controlPlane</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">endpoint</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://1.2.3.4</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">localAPIServerPort</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">443</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="clustername">clusterName</h4>
<p>Configures the cluster&rsquo;s name.</p>
<p>Type: <code>string</code></p>
<h4 id="network-1">network</h4>
<p>Provides cluster network configuration.</p>
<p>Type: <code>ClusterNetworkConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">network</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">cni</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">flannel</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">dnsDomain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">cluster.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">podSubnets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#0000cf;font-weight:bold">10.244.0.0</span><span style="color:#000">/16</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">serviceSubnets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#0000cf;font-weight:bold">10.96.0.0</span><span style="color:#000">/12</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="token-1">token</h4>
<p>The <a href="https://kubernetes.io/docs/reference/access-authn-authz/bootstrap-tokens/">bootstrap token</a>.</p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">wlzjyw.bei2zfylhs2by0wd</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="aescbcencryptionsecret">aescbcEncryptionSecret</h4>
<p>The key used for the <a href="https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/">encryption of secret data at rest</a>.</p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">z01mye6j16bspJYtTB/5SFX8j7Ph4JXxM2Xuu4vsBPM=</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="ca-1">ca</h4>
<p>The base64 encoded root certificate authority used by Kubernetes.</p>
<p>Type: <code>PEMEncodedCertificateAndKey</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBDRV...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBSU0...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="apiserver">apiServer</h4>
<p>API server specific configuration options.</p>
<p>Type: <code>APIServerConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">apiServer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">certSANs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#0000cf;font-weight:bold">1.2.3.4</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#0000cf;font-weight:bold">5.6.7.8</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="controllermanager">controllerManager</h4>
<p>Controller manager server specific configuration options.</p>
<p>Type: <code>ControllerManagerConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">controllerManager</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="proxy">proxy</h4>
<p>Kube-proxy server-specific configuration options</p>
<p>Type: <code>ProxyConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">proxy</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ipvs</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="scheduler">scheduler</h4>
<p>Scheduler server specific configuration options.</p>
<p>Type: <code>SchedulerConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">scheduler</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="etcd">etcd</h4>
<p>Etcd specific configuration options.</p>
<p>Type: <code>EtcdConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">etcd</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBDRV...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBSU0...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="podcheckpointer">podCheckpointer</h4>
<p>Pod Checkpointer specific configuration options.</p>
<p>Type: <code>PodCheckpointer</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">podCheckpointer</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="coredns">coreDNS</h4>
<p>Core DNS specific configuration options.</p>
<p>Type: <code>CoreDNS</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">coreDNS</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="extramanifests">extraManifests</h4>
<p>A list of urls that point to additional manifests.
These will get automatically deployed by bootkube.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraManifests</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;https://www.mysweethttpserver.com/manifest1.yaml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;https://www.mysweethttpserver.com/manifest2.yaml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="extramanifestheaders">extraManifestHeaders</h4>
<p>A map of key value pairs that will be added while fetching the ExtraManifests.</p>
<p>Type: <code>map</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraManifestHeaders</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">Token</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;1234567&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">X-ExtraInfo</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">info</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="adminkubeconfig">adminKubeconfig</h4>
<p>Settings for admin kubeconfig generation.
Certificate lifetime can be configured.</p>
<p>Type: <code>AdminKubeconfigConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">adminKubeconfig</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">certLifetime</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">1h</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><hr>
<h3 id="kubeletconfig">KubeletConfig</h3>
<h4 id="image">image</h4>
<p>The <code>image</code> field is an optional reference to an alternative kubelet image.</p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">docker.io/&lt;org&gt;/kubelet:latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="extraargs">extraArgs</h4>
<p>The <code>extraArgs</code> field is used to provide additional flags to the kubelet.</p>
<p>Type: <code>map</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">value</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="extramounts">extraMounts</h4>
<p>The <code>extraMounts</code> field is used to add additional mounts to the kubelet container.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraMounts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">source</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/lib/example</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">destination</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">/var/lib/example</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">type</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">bind</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">options</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">rshared</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">ro</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><hr>
<h3 id="networkconfig">NetworkConfig</h3>
<h4 id="hostname">hostname</h4>
<p>Used to statically set the hostname for the host.</p>
<p>Type: <code>string</code></p>
<h4 id="interfaces">interfaces</h4>
<p><code>interfaces</code> is used to define the network interface configuration.
By default all network interfaces will attempt a DHCP discovery.
This can be further tuned through this configuration parameter.</p>
<h5 id="machinenetworkinterfacesinterface">machine.network.interfaces.interface</h5>
<p>This is the interface name that should be configured.</p>
<h5 id="machinenetworkinterfacescidr">machine.network.interfaces.cidr</h5>
<p><code>cidr</code> is used to specify a static IP address to the interface.
This should be in proper CIDR notation ( <code>192.168.2.5/24</code> ).</p>
<blockquote>
<p>Note: This option is mutually exclusive with DHCP.</p>
</blockquote>
<h5 id="machinenetworkinterfacesdhcp">machine.network.interfaces.dhcp</h5>
<p><code>dhcp</code> is used to specify that this device should be configured via DHCP.</p>
<p>The following DHCP options are supported:</p>
<ul>
<li><code>OptionClasslessStaticRoute</code></li>
<li><code>OptionDomainNameServer</code></li>
<li><code>OptionDNSDomainSearchList</code></li>
<li><code>OptionHostName</code></li>
</ul>
<blockquote>
<p>Note: This option is mutually exclusive with CIDR.</p>
</blockquote>
<h5 id="machinenetworkinterfacesignore">machine.network.interfaces.ignore</h5>
<p><code>ignore</code> is used to exclude a specific interface from configuration.
This parameter is optional.</p>
<h5 id="machinenetworkinterfacesdummy">machine.network.interfaces.dummy</h5>
<p><code>dummy</code> is used to specify that this interface should be a virtual-only, dummy interface.
This parameter is optional.</p>
<h5 id="machinenetworkinterfacesroutes">machine.network.interfaces.routes</h5>
<p><code>routes</code> is used to specify static routes that may be necessary.
This parameter is optional.</p>
<p>Routes can be repeated and includes a <code>Network</code> and <code>Gateway</code> field.</p>
<p>Type: <code>array</code></p>
<h4 id="nameservers">nameservers</h4>
<p>Used to statically set the nameservers for the host.
Defaults to <code>1.1.1.1</code> and <code>8.8.8.8</code></p>
<p>Type: <code>array</code></p>
<h4 id="extrahostentries">extraHostEntries</h4>
<p>Allows for extra entries to be added to /etc/hosts file</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraHostEntries</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">ip</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">192.168.1.100</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">aliases</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">test</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">      </span>- <span style="color:#000">test.domain.tld</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><hr>
<h3 id="installconfig">InstallConfig</h3>
<h4 id="disk">disk</h4>
<p>The disk used to install the bootloader, and ephemeral partitions.</p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">/dev/sda</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">/dev/nvme0</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="extrakernelargs">extraKernelArgs</h4>
<p>Allows for supplying extra kernel args to the bootloader config.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraKernelArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">a=b</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="image-1">image</h4>
<p>Allows for supplying the image used to perform the installation.</p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">image</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">docker.io/&lt;org&gt;/installer:latest</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="bootloader">bootloader</h4>
<p>Indicates if a bootloader should be installed.</p>
<p>Type: <code>bool</code></p>
<p>Valid Values:</p>
<ul>
<li><code>true</code></li>
<li><code>yes</code></li>
<li><code>false</code></li>
<li><code>no</code></li>
</ul>
<h4 id="wipe">wipe</h4>
<p>Indicates if zeroes should be written to the <code>disk</code> before performing and installation.
Defaults to <code>true</code>.</p>
<p>Type: <code>bool</code></p>
<p>Valid Values:</p>
<ul>
<li><code>true</code></li>
<li><code>yes</code></li>
<li><code>false</code></li>
<li><code>no</code></li>
</ul>
<h4 id="force">force</h4>
<p>Indicates if filesystems should be forcefully created.</p>
<p>Type: <code>bool</code></p>
<p>Valid Values:</p>
<ul>
<li><code>true</code></li>
<li><code>yes</code></li>
<li><code>false</code></li>
<li><code>no</code></li>
</ul>
<hr>
<h3 id="timeconfig">TimeConfig</h3>
<h4 id="servers">servers</h4>
<p>Specifies time (ntp) servers to use for setting system time.
Defaults to <code>pool.ntp.org</code></p>
<blockquote>
<p>Note: This parameter only supports a single time server</p>
</blockquote>
<p>Type: <code>array</code></p>
<hr>
<h3 id="registriesconfig">RegistriesConfig</h3>
<h4 id="mirrors">mirrors</h4>
<p>Specifies mirror configuration for each registry.
This setting allows to use local pull-through caching registires,
air-gapped installations, etc.</p>
<p>Registry name is the first segment of image identifier, with &lsquo;docker.io&rsquo;
being default one.
Name &lsquo;*&rsquo; catches any registry names not specified explicitly.</p>
<p>Type: <code>map</code></p>
<h4 id="config-1">config</h4>
<p>Specifies TLS &amp; auth configuration for HTTPS image registries.
Mutual TLS can be enabled with &lsquo;clientIdentity&rsquo; option.</p>
<p>TLS configuration can be skipped if registry has trusted
server certificate.</p>
<p>Type: <code>map</code></p>
<hr>
<h3 id="podcheckpointer-1">PodCheckpointer</h3>
<h4 id="image-2">image</h4>
<p>The <code>image</code> field is an override to the default pod-checkpointer image.</p>
<p>Type: <code>string</code></p>
<hr>
<h3 id="coredns-1">CoreDNS</h3>
<h4 id="image-3">image</h4>
<p>The <code>image</code> field is an override to the default coredns image.</p>
<p>Type: <code>string</code></p>
<hr>
<h3 id="endpoint">Endpoint</h3>
<hr>
<h3 id="controlplaneconfig">ControlPlaneConfig</h3>
<h4 id="endpoint-1">endpoint</h4>
<p>Endpoint is the canonical controlplane endpoint, which can be an IP address or a DNS hostname.
It is single-valued, and may optionally include a port number.</p>
<p>Type: <code>Endpoint</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">https://1.2.3.4:443</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="localapiserverport">localAPIServerPort</h4>
<p>The port that the API server listens on internally.
This may be different than the port portion listed in the endpoint field above.
The default is 6443.</p>
<p>Type: <code>int</code></p>
<hr>
<h3 id="apiserverconfig">APIServerConfig</h3>
<h4 id="image-4">image</h4>
<p>The container image used in the API server manifest.</p>
<p>Type: <code>string</code></p>
<h4 id="extraargs-1">extraArgs</h4>
<p>Extra arguments to supply to the API server.</p>
<p>Type: <code>map</code></p>
<h4 id="certsans-1">certSANs</h4>
<p>Extra certificate subject alternative names for the API server&rsquo;s certificate.</p>
<p>Type: <code>array</code></p>
<hr>
<h3 id="controllermanagerconfig">ControllerManagerConfig</h3>
<h4 id="image-5">image</h4>
<p>The container image used in the controller manager manifest.</p>
<p>Type: <code>string</code></p>
<h4 id="extraargs-2">extraArgs</h4>
<p>Extra arguments to supply to the controller manager.</p>
<p>Type: <code>map</code></p>
<hr>
<h3 id="proxyconfig">ProxyConfig</h3>
<h4 id="image-6">image</h4>
<p>The container image used in the kube-proxy manifest.</p>
<p>Type: <code>string</code></p>
<h4 id="mode">mode</h4>
<p>proxy mode of kube-proxy.
By default, this is &lsquo;iptables&rsquo;.</p>
<p>Type: <code>string</code></p>
<h4 id="extraargs-3">extraArgs</h4>
<p>Extra arguments to supply to kube-proxy.</p>
<p>Type: <code>map</code></p>
<hr>
<h3 id="schedulerconfig">SchedulerConfig</h3>
<h4 id="image-7">image</h4>
<p>The container image used in the scheduler manifest.</p>
<p>Type: <code>string</code></p>
<h4 id="extraargs-4">extraArgs</h4>
<p>Extra arguments to supply to the scheduler.</p>
<p>Type: <code>map</code></p>
<hr>
<h3 id="etcdconfig">EtcdConfig</h3>
<h4 id="image-8">image</h4>
<p>The container image used to create the etcd service.</p>
<p>Type: <code>string</code></p>
<h4 id="ca-2">ca</h4>
<p>The <code>ca</code> is the root certificate authority of the PKI.
It is composed of a base64 encoded <code>crt</code> and <code>key</code>.</p>
<p>Type: <code>PEMEncodedCertificateAndKey</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">ca</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJIekNCMHF...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0KTUM...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="extraargs-5">extraArgs</h4>
<p>Extra arguments to supply to etcd.
Note that the following args are not allowed:</p>
<ul>
<li><code>name</code></li>
<li><code>data-dir</code></li>
<li><code>initial-cluster-state</code></li>
<li><code>listen-peer-urls</code></li>
<li><code>listen-client-urls</code></li>
<li><code>cert-file</code></li>
<li><code>key-file</code></li>
<li><code>trusted-ca-file</code></li>
<li><code>peer-client-cert-auth</code></li>
<li><code>peer-cert-file</code></li>
<li><code>peer-trusted-ca-file</code></li>
<li><code>peer-key-file</code></li>
</ul>
<p>Type: <code>map</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">extraArgs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">initial-cluster</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://1.2.3.4:2380</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">advertise-client-urls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https://1.2.3.4:2379</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><hr>
<h3 id="clusternetworkconfig">ClusterNetworkConfig</h3>
<h4 id="cni">cni</h4>
<p>The CNI used.
Composed of &ldquo;name&rdquo; and &ldquo;url&rdquo;.
The &ldquo;name&rdquo; key only supports upstream bootkube options of &ldquo;flannel&rdquo; or &ldquo;custom&rdquo;.
URLs is only used if name is equal to &ldquo;custom&rdquo;.
URLs should point to a single yaml file that will get deployed.
Empty struct or any other name will default to bootkube&rsquo;s flannel.</p>
<p>Type: <code>CNIConfig</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">cni</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;custom&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">urls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#4e9a06">&#34;https://www.mysweethttpserver.com/supersecretcni.yaml&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="dnsdomain">dnsDomain</h4>
<p>The domain used by Kubernetes DNS.
The default is <code>cluster.local</code></p>
<p>Type: <code>string</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000">cluser.local</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="podsubnets">podSubnets</h4>
<p>The pod subnet CIDR.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">podSubnets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#0000cf;font-weight:bold">10.244.0.0</span><span style="color:#000">/16</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="servicesubnets">serviceSubnets</h4>
<p>The service subnet CIDR.</p>
<p>Type: <code>array</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">serviceSubnets</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#0000cf;font-weight:bold">10.96.0.0</span><span style="color:#000">/12</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><hr>
<h3 id="cniconfig">CNIConfig</h3>
<h4 id="name">name</h4>
<p>Name of CNI to use.</p>
<p>Type: <code>string</code></p>
<h4 id="urls">urls</h4>
<p>URLs containing manifests to apply for CNI.</p>
<p>Type: <code>array</code></p>
<hr>
<h3 id="adminkubeconfigconfig">AdminKubeconfigConfig</h3>
<h4 id="certlifetime">certLifetime</h4>
<p>Admin kubeconfig certificate lifetime (default is 1 year).
Field format accepts any Go time.Duration format (&lsquo;1h&rsquo; for one hour, &lsquo;10m&rsquo; for ten minutes).</p>
<p>Type: <code>Duration</code></p>
<hr>
<h3 id="machinedisk">MachineDisk</h3>
<h4 id="device">device</h4>
<p>The name of the disk to use.
Type: <code>string</code></p>
<h4 id="partitions">partitions</h4>
<p>A list of partitions to create on the disk.
Type: <code>array</code></p>
<hr>
<h3 id="diskpartition">DiskPartition</h3>
<h4 id="size">size</h4>
<p>The size of the partition in bytes. If <code>size:</code> is omitted, the partition is sized to occupy the full disk.</p>
<p>Type: <code>uint</code></p>
<h4 id="mountpoint">mountpoint</h4>
<p>Where to mount the partition.
Type: <code>string</code></p>
<hr>
<h3 id="machinefile">MachineFile</h3>
<h4 id="content">content</h4>
<p>The contents of file.
Type: <code>string</code></p>
<h4 id="permissions">permissions</h4>
<p>The file&rsquo;s permissions in octal.
Type: <code>FileMode</code></p>
<h4 id="path">path</h4>
<p>The path of the file.
Type: <code>string</code></p>
<h4 id="op">op</h4>
<p>The operation to use
Type: <code>string</code></p>
<p>Valid Values:</p>
<ul>
<li><code>create</code></li>
<li><code>append</code></li>
</ul>
<hr>
<h3 id="extrahost">ExtraHost</h3>
<h4 id="ip">ip</h4>
<p>The IP of the host.
Type: <code>string</code></p>
<h4 id="aliases">aliases</h4>
<p>The host alias.
Type: <code>array</code></p>
<hr>
<h3 id="device-1">Device</h3>
<h4 id="interface">interface</h4>
<p>The interface name.
Type: <code>string</code></p>
<h4 id="cidr">cidr</h4>
<p>The CIDR to use.
Type: <code>string</code></p>
<h4 id="routes">routes</h4>
<p>A list of routes associated with the interface.
Type: <code>array</code></p>
<h4 id="bond">bond</h4>
<p>Bond specific options.
Type: <code>Bond</code></p>
<h4 id="vlans">vlans</h4>
<p>VLAN specific options.
Type: <code>array</code></p>
<h4 id="mtu">mtu</h4>
<p>The interface&rsquo;s MTU.
Type: <code>int</code></p>
<h4 id="dhcp">dhcp</h4>
<p>Indicates if DHCP should be used.
Type: <code>bool</code></p>
<h4 id="ignore">ignore</h4>
<p>Indicates if the interface should be ignored.
Type: <code>bool</code></p>
<h4 id="dummy">dummy</h4>
<p>Indicates if the interface is a dummy interface.
Type: <code>bool</code></p>
<hr>
<h3 id="bond-1">Bond</h3>
<h4 id="interfaces-1">interfaces</h4>
<p>The interfaces that make up the bond.
Type: <code>array</code></p>
<h4 id="arpiptarget">arpIPTarget</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>array</code></p>
<h4 id="mode-1">mode</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="xmithashpolicy">xmitHashPolicy</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="lacprate">lacpRate</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="adactorsystem">adActorSystem</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="arpvalidate">arpValidate</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="arpalltargets">arpAllTargets</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="primary">primary</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="primaryreselect">primaryReselect</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="failovermac">failOverMac</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="adselect">adSelect</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>string</code></p>
<h4 id="miimon">miimon</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="updelay">updelay</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="downdelay">downdelay</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="arpinterval">arpInterval</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="resendigmp">resendIgmp</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="minlinks">minLinks</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="lpinterval">lpInterval</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="packetsperslave">packetsPerSlave</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<h4 id="numpeernotif">numPeerNotif</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint8</code></p>
<h4 id="tlbdynamiclb">tlbDynamicLb</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint8</code></p>
<h4 id="allslavesactive">allSlavesActive</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint8</code></p>
<h4 id="usecarrier">useCarrier</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>bool</code></p>
<h4 id="adactorsysprio">adActorSysPrio</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint16</code></p>
<h4 id="aduserportkey">adUserPortKey</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint16</code></p>
<h4 id="peernotifydelay">peerNotifyDelay</h4>
<p>A bond option.
Please see the official kernel documentation.</p>
<p>Type: <code>uint32</code></p>
<hr>
<h3 id="vlan">Vlan</h3>
<h4 id="cidr-1">cidr</h4>
<p>The CIDR to use.
Type: <code>string</code></p>
<h4 id="routes-1">routes</h4>
<p>A list of routes associated with the VLAN.
Type: <code>array</code></p>
<h4 id="dhcp-1">dhcp</h4>
<p>Indicates if DHCP should be used.
Type: <code>bool</code></p>
<h4 id="vlanid">vlanId</h4>
<p>The VLAN&rsquo;s ID.
Type: <code>uint16</code></p>
<hr>
<h3 id="route">Route</h3>
<h4 id="network-2">network</h4>
<p>The route&rsquo;s network.
Type: <code>string</code></p>
<h4 id="gateway">gateway</h4>
<p>The route&rsquo;s gateway.
Type: <code>string</code></p>
<hr>
<h3 id="registrymirrorconfig">RegistryMirrorConfig</h3>
<h4 id="endpoints">endpoints</h4>
<p>List of endpoints (URLs) for registry mirrors to use.
Endpoint configures HTTP/HTTPS access mode, host name,
port and path (if path is not set, it defaults to <code>/v2</code>).</p>
<p>Type: <code>array</code></p>
<hr>
<h3 id="registryconfig">RegistryConfig</h3>
<h4 id="tls">tls</h4>
<p>The TLS configuration for this registry.
Type: <code>RegistryTLSConfig</code></p>
<h4 id="auth">auth</h4>
<p>The auth configuration for this registry.
Type: <code>RegistryAuthConfig</code></p>
<hr>
<h3 id="registryauthconfig">RegistryAuthConfig</h3>
<h4 id="username">username</h4>
<p>Optional registry authentication.
The meaning of each field is the same with the corresponding field in .docker/config.json.</p>
<p>Type: <code>string</code></p>
<h4 id="password">password</h4>
<p>Optional registry authentication.
The meaning of each field is the same with the corresponding field in .docker/config.json.</p>
<p>Type: <code>string</code></p>
<h4 id="auth-1">auth</h4>
<p>Optional registry authentication.
The meaning of each field is the same with the corresponding field in .docker/config.json.</p>
<p>Type: <code>string</code></p>
<h4 id="identitytoken">identityToken</h4>
<p>Optional registry authentication.
The meaning of each field is the same with the corresponding field in .docker/config.json.</p>
<p>Type: <code>string</code></p>
<hr>
<h3 id="registrytlsconfig">RegistryTLSConfig</h3>
<h4 id="clientidentity">clientIdentity</h4>
<p>Enable mutual TLS authentication with the registry.
Client certificate and key should be base64-encoded.</p>
<p>Type: <code>PEMEncodedCertificateAndKey</code></p>
<p>Examples:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#204a87;font-weight:bold">clientIdentity</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">crt</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJIekNCMHF...</span><span style="color:#f8f8f8;text-decoration:underline">
</span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">key</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">LS0tLS1CRUdJTiBFRDI1NTE5IFBSSVZBVEUgS0VZLS0tLS0KTUM...</span><span style="color:#f8f8f8;text-decoration:underline">
</span></code></pre></div><h4 id="ca-3">ca</h4>
<p>CA registry certificate to add the list of trusted certificates.
Certificate should be base64-encoded.</p>
<p>Type: <code>array</code></p>
<h4 id="insecureskipverify">insecureSkipVerify</h4>
<p>Skip TLS server certificate verification (not recommended).</p>
<p>Type: <code>bool</code></p>
<hr>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-183bbaed2c8c4fb9e080fa3e6a67f9ad">8 - Virtualized Platforms</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-a4f2a371fb298324d51b12f31514c5cd">8.1 - Hyper-V</h1>
    
	<p>Talos is known to work on Hyper-V; however, it is currently undocumented.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-93515b515d47d3fa0127424282a22a10">8.2 - KVM</h1>
    
	<p>Talos is known to work on KVM; however, it is currently undocumented.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d61a94d39bacb036d37cb29d7f9b62f2">8.3 - Proxmox</h1>
    
	<p>Talos is known to work on Proxmox; however, it is currently undocumented.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0f59ff1d2cb197f7cfaf0ffa7ea05bbc">8.4 - VMware</h1>
    
	<h2 id="creating-a-cluster-via-the-govc-cli">Creating a Cluster via the <code>govc</code> CLI</h2>
<p>In this guide we will create an HA Kubernetes cluster with 3 worker nodes.
We will use the <code>govc</code> cli which can be downloaded <a href="https://github.com/vmware/govmomi/tree/master/govc#installation">here</a>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>Prior to starting, it is important to have the following infrastructure in place and available:</p>
<ul>
<li>DHCP server</li>
<li>Load Balancer or DNS address for cluster endpoint
<ul>
<li>If using a load balancer, the most common setup is to balance <code>tcp/443</code> across the control plane nodes <code>tcp/6443</code></li>
<li>If using a DNS address, the A record should return back the addresses of the control plane nodes</li>
</ul>
</li>
</ul>
<h3 id="create-the-machine-configuration-files">Create the Machine Configuration Files</h3>
<h4 id="generating-base-configurations">Generating Base Configurations</h4>
<p>Using the DNS name or name of the loadbalancer used in the prereq steps, generate the base configuration files for the Talos machines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl gen config talos-k8s-vmware-tutorial https://&lt;load balancer IP or DNS&gt;:&lt;port&gt;
created init.yaml
created controlplane.yaml
created join.yaml
created talosconfig
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl gen config talos-k8s-vmware-tutorial https://&lt;DNS name&gt;:6443
created init.yaml
created controlplane.yaml
created join.yaml
created talosconfig
</code></pre></div><p>At this point, you can modify the generated configs to your liking.</p>
<h4 id="validate-the-configuration-files">Validate the Configuration Files</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ talosctl validate --config init.yaml --mode cloud
init.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
$ talosctl validate --config controlplane.yaml --mode cloud
controlplane.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
$ talosctl validate --config join.yaml --mode cloud
join.yaml is valid <span style="color:#204a87;font-weight:bold">for</span> cloud mode
</code></pre></div><h3 id="set-environment-variables">Set Environment Variables</h3>
<p><code>govc</code> makes use of the following environment variables</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">GOVC_URL</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter url&gt;
<span style="color:#204a87">export</span> <span style="color:#000">GOVC_USERNAME</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter username&gt;
<span style="color:#204a87">export</span> <span style="color:#000">GOVC_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter password&gt;
</code></pre></div><blockquote>
<p>Note: If your vCenter installation makes use of self signed certificates, you&rsquo;ll want to export <code>GOVC_INSECURE=true</code>.</p>
</blockquote>
<p>There are some additional variables that you may need to set:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">GOVC_DATACENTER</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter datacenter&gt;
<span style="color:#204a87">export</span> <span style="color:#000">GOVC_RESOURCE_POOL</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter resource pool&gt;
<span style="color:#204a87">export</span> <span style="color:#000">GOVC_DATASTORE</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter datastore&gt;
<span style="color:#204a87">export</span> <span style="color:#000">GOVC_NETWORK</span><span style="color:#ce5c00;font-weight:bold">=</span>&lt;vCenter network&gt;
</code></pre></div><h3 id="download-the-ova">Download the OVA</h3>
<p>A <code>talos.ova</code> asset is published with each <a href="https://github.com/talos-systems/talos/releases">release</a>.
We will refer to the version of the release as <code>$TALOS_VERSION</code> below.
It can be easily exported with <code>export TALOS_VERSION=&quot;v0.3.0-alpha.10&quot;</code> or similar.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -LO https://github.com/talos-systems/talos/releases/download/<span style="color:#000">$TALOS_VERSION</span>/talos.ova
</code></pre></div><h3 id="import-the-ova-into-vcenter">Import the OVA into vCenter</h3>
<p>We&rsquo;ll need to repeat this step for each Talos node we want to create.
In a typical HA setup, we&rsquo;ll have 3 control plane nodes and N workers.
In the following example, we&rsquo;ll setup a HA control plane with two worker nodes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc import.ova -name talos-<span style="color:#000">$TALOS_VERSION</span> /path/to/downloaded/talos.ova
</code></pre></div><h4 id="create-the-bootstrap-node">Create the Bootstrap Node</h4>
<p>We&rsquo;ll clone the OVA to create the bootstrap node (our first control plane node).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.clone -on<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> -vm talos-<span style="color:#000">$TALOS_VERSION</span> control-plane-1
</code></pre></div><p>Talos makes use of the <code>guestinfo</code> facility of VMware to provide the machine/cluster configuration.
This can be set using the <code>govc vm.change</code> command.
To facilitate persistent storage using the vSphere cloud provider integration with Kubernetes, <code>disk.enableUUID=1</code> is used.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;guestinfo.talos.config=</span><span style="color:#204a87;font-weight:bold">$(</span>cat init.yaml <span style="color:#000;font-weight:bold">|</span> base64<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;disk.enableUUID=1&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/control-plane-1
</code></pre></div><h4 id="update-hardware-resources-for-the-bootstrap-node">Update Hardware Resources for the Bootstrap Node</h4>
<ul>
<li><code>-c</code> is used to configure the number of cpus</li>
<li><code>-m</code> is used to configure the amount of memory (in MB)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -c <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m <span style="color:#0000cf;font-weight:bold">4096</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/control-plane-1
</code></pre></div><p>The following can be used to adjust the ephemeral disk size.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.disk.change -vm control-plane-1 -disk.name disk-1000-0 -size 10G
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.power -on control-plane-1
</code></pre></div><h4 id="create-the-remaining-control-plane-nodes">Create the Remaining Control Plane Nodes</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.clone -on<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> -vm talos-<span style="color:#000">$TALOS_VERSION</span> control-plane-2
govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;guestinfo.talos.config=</span><span style="color:#204a87;font-weight:bold">$(</span>base64 controlplane.yaml<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;disk.enableUUID=1&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/control-plane-2
govc vm.clone -on<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> -vm talos-<span style="color:#000">$TALOS_VERSION</span> control-plane-3
govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;guestinfo.talos.config=</span><span style="color:#204a87;font-weight:bold">$(</span>base64 controlplane.yaml<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;disk.enableUUID=1&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/control-plane-3
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -c <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m <span style="color:#0000cf;font-weight:bold">4096</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/control-plane-2
govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -c <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m <span style="color:#0000cf;font-weight:bold">4096</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/control-plane-3
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.disk.change -vm control-plane-2 -disk.name disk-1000-0 -size 10G
govc vm.disk.change -vm control-plane-3 -disk.name disk-1000-0 -size 10G
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.power -on control-plane-2
govc vm.power -on control-plane-3
</code></pre></div><h4 id="update-settings-for-the-worker-nodes">Update Settings for the Worker Nodes</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.clone -on<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> -vm talos-<span style="color:#000">$TALOS_VERSION</span> worker-1
govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;guestinfo.talos.config=</span><span style="color:#204a87;font-weight:bold">$(</span>base64 join.yaml<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;disk.enableUUID=1&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/worker-1
govc vm.clone -on<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> -vm talos-<span style="color:#000">$TALOS_VERSION</span> worker-2
govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;guestinfo.talos.config=</span><span style="color:#204a87;font-weight:bold">$(</span>base64 join.yaml<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -e <span style="color:#4e9a06">&#34;disk.enableUUID=1&#34;</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/worker-2
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -c <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m <span style="color:#0000cf;font-weight:bold">8192</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/worker-1
govc vm.change <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -c <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -m <span style="color:#0000cf;font-weight:bold">8192</span> <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  -vm /ha-datacenter/vm/worker-2
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.disk.change -vm worker-1 -disk.name disk-1000-0 -size 50G
govc vm.disk.change -vm worker-2 -disk.name disk-1000-0 -size 50G
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">govc vm.power -on worker-1
govc vm.power -on worker-2
</code></pre></div><h3 id="retrieve-the-kubeconfig">Retrieve the <code>kubeconfig</code></h3>
<p>At this point we can retrieve the admin <code>kubeconfig</code> by running:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">talosctl --talosconfig talosconfig config endpoint &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig config node &lt;control plane <span style="color:#0000cf;font-weight:bold">1</span> IP&gt;
talosctl --talosconfig talosconfig kubeconfig .
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a17a30484a09b0ced1d0ebb1dda5950b">8.5 - Xen</h1>
    
	<p>Talos is known to work on Xen; however, it is currently undocumented.</p>

</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://twitter.com/SideroLabs" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/talos-systems/talos" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Sidero Labs, Inc. All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>


















<script src="/js/main.min.7380160122c24d59789a168af05fcec445fe4e5f2069dd9f3a0c991f10269ae0.js" integrity="sha256-c4AWASLCTVl4mhaK8F/OxEX&#43;Tl8gad2fOgyZHxAmmuA=" crossorigin="anonymous"></script>






  </body>
</html>
